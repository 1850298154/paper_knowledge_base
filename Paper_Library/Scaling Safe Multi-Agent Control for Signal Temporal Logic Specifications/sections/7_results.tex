\section{Results}
\label{sec:results}
Our results (Table \ref{tab:dubins-spec-v-n-results}) demonstrate how differentiable STL can be used to ensure agents achieve complex objectives while avoiding collisions in multi-agent systems.

\paragraph{Scalability in number of agents}



We first evaluate the scalability of our approach in the number of agents ($N$) for the non-linear DubinsCar environment.
% We first evaluate the scalability of our approach in the number of agents ($N$) for the SingleIntegrator environment. 
From the results, we observe that the success rate decreases gradually as the number of agents increases, which is expected as the number of agents increases the complexity of the problem.
%The mean score also decreases as the number of agents increases, which is expected as the agents balance safety to avoid collisions. 
% The planning time increases as the number of agents increases, this is drastic in the STLPY setting. 
%The safety rate remains at or near 100\% for all the experiments, which indicates that our planner still enables collision avoidance maneuvers. 
%The results show that our planner is able to scale in the number of agents while ensuring safety.
The results show that the single agent view of STLPY proves unsuccessful especially in the $N=32$ case where agent interactions are more prevalent.
Notably our approach has a planning time that is 70-1000x faster than the MILP-based planner (STLPY) and does not blow up when considering a larger number of agents $N$.
%, which indicates that our approach is able to scale in the number of agents.

\begin{table*}[t!]
	\small
	\centering
	\scalebox{0.7}{
		\begin{tabular}{l|l|cc|cc|cc||cc||cc}
  \toprule
			\multicolumn{2}{c|}{Metric}                                                           & \multicolumn{2}{c|}{Planning Time (s) $\downarrow$} & \multicolumn{2}{c|}{Finish Rate (\%) $\uparrow$} & \multicolumn{2}{c||}{Safety Rate (\%) $\uparrow$} & \multicolumn{2}{c||}{Success Rate (\%) $\uparrow$} & \multicolumn{2}{c}{TtR (steps) $\downarrow$}                                                                                                     \\
			\midrule
			                                                                                      \multicolumn{2}{c|}{Planner}                                            & \multirowcell{2}{\shortstack{GNN-ODE}}                                     & \multirowcell{2}{\shortstack{STLPY}}                                        &  \multirowcell{2}{\shortstack{GNN-ODE}}                                     & \multirowcell{2}{\shortstack{STLPY}}                                &  \multirowcell{2}{\shortstack{GNN-ODE}}                                     & \multirowcell{2}{\shortstack{STLPY}}            &  \multirowcell{2}{\shortstack{GNN-ODE}}                                     & \multirowcell{2}{\shortstack{STLPY}}           &  \multirowcell{2}{\shortstack{GNN-ODE}}                                     & \multirowcell{2}{\shortstack{STLPY}}             \\
			                                                                                      \cline{1-2}
			Spec                                                                                  & N                                                   &                                             &                                             &                                              &                                      &                 &                 &                 &                &         &                  \\
			\hline
			\multirow[t]{3}{*}[-1.2em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Branch}}} & 8                                                   & \textbf{0.05}                               & 22.48                                       & \textbf{100.00}                              & 100.00                               & \textbf{100.00} & 85.00           & \textbf{100.00} & 85.00          & 712.50  & \textbf{357.00 } \\
			                                                                                      & 16                                                  & \textbf{0.04}                               & 43.80                                       & \textbf{100.00}                              & 99.00                                & \textbf{100.00} & 53.75           & \textbf{100.00} & 52.50          & 745.12  & \textbf{429.81 } \\
			                                                                                      & 32                                                  & \textbf{0.03}                               & 87.92                                       & 95.00                                        & \textbf{96.00}                       & \textbf{92.50 } & 20.00           & \textbf{88.12 } & 18.12          & 820.90  & \textbf{572.39 } \\
			\hline\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Cover}}}  & 8                                                   & \textbf{0.02}                               & 10.40                                       & \textbf{100.00}                              & 95.00                                & \textbf{100.00} & 97.50           & \textbf{100.00} & 95.00          & 1062.00 & \textbf{429.76 } \\
			                                                                                      & 16                                                  & \textbf{0.02}                               & 20.14                                       & \textbf{100.00}                              & 78.00                                & \textbf{96.25 } & 87.50           & \textbf{96.25 } & 76.25          & 1124.25 & \textbf{536.33 } \\
			                                                                                      & 32                                                  & \textbf{0.03}                               & 40.19                                       & \textbf{99.00 }                              & 80.00                                & \textbf{85.00 } & 56.88           & \textbf{84.38 } & 53.75          & 1252.59 & \textbf{708.22 } \\
			\hline\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Loop}}}   & 8                                                   & \textbf{0.02}                               & 26.16                                       & \textbf{100.00}                              & 98.00                                & \textbf{100.00} & 82.50           & \textbf{100.00} & 80.00          & 1874.00 & \textbf{1095.29} \\
			                                                                                      & 16                                                  & \textbf{0.02}                               & 52.79                                       & \textbf{100.00}                              & 99.00                                & \textbf{97.50 } & 67.50           & \textbf{97.50 } & 66.25          & 1927.50 & \textbf{1301.54} \\
			                                                                                      & 32                                                  & \textbf{0.04}                               & 111.62                                      & 99.00                                        & \textbf{100.00}                      & \textbf{86.25 } & 38.75           & \textbf{85.62 } & 38.75          & 2110.88 & \textbf{1598.19} \\
			\hline\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Seq. }}}  & 8                                                   & \textbf{0.07}                               & 3.46                                        & 95.00                                        & \textbf{98.00}                       & 95.00           & \textbf{100.00} & 95.00           & \textbf{97.50} & 988.64  & \textbf{637.11 } \\
			                                                                                      & 16                                                  & \textbf{0.07}                               & 6.96                                        & \textbf{90.00 }                              & 89.00                                & \textbf{93.75 } & 90.00           & \textbf{86.25 } & 85.00          & 1173.44 & \textbf{785.97 } \\
			                                                                                      & 32                                                  & \textbf{0.08}                               & 13.62                                       & \textbf{89.00 }                              & 84.00                                & \textbf{76.25 } & 64.38           & \textbf{66.88 } & 59.38          & 1277.91 & \textbf{1013.90} \\
			\midrule
			\bottomrule
		\end{tabular}
	}
	\caption{Performance of the two planning schemes with 
 % the scalability in 
 the number of agents ($N$) and specification complexity for the DubinsCar Environment.
 \label{tab:dubins-spec-v-n-results}
		%	\SJ{The cells with the dark blue colors are not readable.  Define units: seconds for planning and TtR and for success rate}
  We note an average 65\% improved success rate and highlight the best result in \textbf{bold}.
% \zk{TODO: add a TL;DR here.}	
}

\vspace{-0.5em}
\end{table*}

\paragraph{Scalability in specification complexity}

For certain specifications such as \branch~and \loopspec, we observe that the MILP planner computation time is significant which can add up over 
different agent initializations.
% is unable to find a solution within the time limit, which indicates that the MILP planner is not able to scale in the specification complexity. % \joe{add loop}
%Additionally for specifications like \branch, we note a significant hit to computation times for the MILP planner due to the specification structure. 
In contrast, our planner is able to generate a solution for all the specifications quickly and consistently for different agent initial positions, motivating our learning-based approach.
We further note the effect in TtR when using our %learning based 
algorithm.  
We rationalize this trade-off because our method finds longer paths that allow goals to be reached by
the \gcbfp~controller, which is trained to avoid other agents. This inherently reduces the number of collisions which is often a greater priority.
From our ablation study (Table \ref{tab:dubins-ode-ablation}) we note the impact of the GNN module especially in terms of a ~28\% impact in success rate for certain specifications such as \seq~which require increased coordination among agents.
We can further reason that the impact in \cover~and \loopspec~of the GNN module is not as great since agents are not required to reach the goals within a strict order and thus require less coordination.
With regards to the lower TtR of the successful runs, the lack of a GNN module may yield plans that can satisfy the specification efficiently but fail in terms of coordination between agents  (affecting the overall success rate). 

% First column
% \multirow[t]{6}{*}[-3em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Cover}}}
% \begin{table*}[t!]
% 	\small
% 	\centering
% 	\scalebox{0.7}{
% 		\begin{tabular}{l|l|cc|cc|cc|cc|cc}
% 			\multicolumn{2}{c|}{Metric}                                                           & \multicolumn{2}{c|}{Planning Time (s) $\downarrow$} & \multicolumn{2}{c|}{Finish Rate $\uparrow$} & \multicolumn{2}{c|}{Safety Rate $\uparrow$} & \multicolumn{2}{c|}{Success Rate $\uparrow$} & \multicolumn{2}{c}{TtR $\downarrow$}                                                                                                                                                                                                              \\
% 			\midrule
% 			                                                                                      & Planner                                             & GNN-ODE                                     & STLPY                                       & GNN-ODE                                      & STLPY                                & GNN-ODE                         & STLPY                           & GNN-ODE                         & STLPY                          & GNN-ODE                          & STLPY                            \\
% 			Spec                                                                                  & N                                                   &                                             &                                             &                                              &                                      &                                 &                                 &                                 &                                &                                  &                                  \\
% 			\hline\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Branch}}} & 8                                                   & \cellcolor[HTML]{2369BD} 0.05               & \cellcolor[HTML]{BDC6D7} 22.48              & \cellcolor[HTML]{2369BD} 100.00              & \cellcolor[HTML]{2369BD} 100.00      & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{7393C0} 85.00  & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{7192C0} 85.00 & \cellcolor[HTML]{CA827F} 712.50  & \cellcolor[HTML]{2369BD} 357.00  \\
% 			                                                                                      & 16                                                  & \cellcolor[HTML]{2369BD} 0.04               & \cellcolor[HTML]{F2DFDD} 43.80              & \cellcolor[HTML]{2369BD} 100.00              & \cellcolor[HTML]{7695C1} 99.00       & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{FAF5F5} 53.75  & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{FAF5F4} 52.50 & \cellcolor[HTML]{C16C6A} 745.12  & \cellcolor[HTML]{92A7C8} 429.81  \\
% 			                                                                                      & 32                                                  & \cellcolor[HTML]{2369BD} 0.03               & \cellcolor[HTML]{A9373B} 87.92              & \cellcolor[HTML]{A9373B} 95.00               & \cellcolor[HTML]{D7A29F} 96.00       & \cellcolor[HTML]{507EBC} 92.50  & \cellcolor[HTML]{A9373B} 20.00  & \cellcolor[HTML]{6489BE} 88.12  & \cellcolor[HTML]{A9373B} 18.12 & \cellcolor[HTML]{A9373B} 820.90  & \cellcolor[HTML]{F7EBEA} 572.39  \\
% 			\hline\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Cover}}}  & 8                                                   & \cellcolor[HTML]{2369BD} 0.02               & \cellcolor[HTML]{BFC8D8} 10.40              & \cellcolor[HTML]{2369BD} 100.00              & \cellcolor[HTML]{809BC3} 95.00       & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{3F75BC} 97.50  & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{5581BC} 95.00 & \cellcolor[HTML]{CA817E} 1062.00 & \cellcolor[HTML]{2369BD} 429.76  \\
% 			                                                                                      & 16                                                  & \cellcolor[HTML]{2369BD} 0.02               & \cellcolor[HTML]{F1DDDB} 20.14              & \cellcolor[HTML]{2369BD} 100.00              & \cellcolor[HTML]{A9373B} 78.00       & \cellcolor[HTML]{4C7CBC} 96.25  & \cellcolor[HTML]{97ABC9} 87.50  & \cellcolor[HTML]{4A7BBC} 96.25  & \cellcolor[HTML]{E9E9ED} 76.25 & \cellcolor[HTML]{C06967} 1124.25 & \cellcolor[HTML]{839DC4} 536.33  \\
% 			                                                                                      & 32                                                  & \cellcolor[HTML]{2369BD} 0.03               & \cellcolor[HTML]{A9373B} 40.19              & \cellcolor[HTML]{3B73BC} 99.00               & \cellcolor[HTML]{C3706E} 80.00       & \cellcolor[HTML]{ABB9D0} 85.00  & \cellcolor[HTML]{A9373B} 56.88  & \cellcolor[HTML]{A7B6CE} 84.38  & \cellcolor[HTML]{A9373B} 53.75 & \cellcolor[HTML]{A9373B} 1252.59 & \cellcolor[HTML]{E1E2E9} 708.22  \\
% 			\hline\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Loop}}}   & 8                                                   & \cellcolor[HTML]{2369BD} 0.02               & \cellcolor[HTML]{B5C0D4} 26.16              & \cellcolor[HTML]{2369BD} 100.00              & \cellcolor[HTML]{A9373B} 98.00       & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{95A9C8} 82.50  & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{A3B4CD} 80.00 & \cellcolor[HTML]{CA827F} 1874.00 & \cellcolor[HTML]{2369BD} 1095.29 \\
% 			                                                                                      & 16                                                  & \cellcolor[HTML]{2369BD} 0.02               & \cellcolor[HTML]{F6E8E7} 52.79              & \cellcolor[HTML]{2369BD} 100.00              & \cellcolor[HTML]{E2E3EA} 99.00       & \cellcolor[HTML]{3972BC} 97.50  & \cellcolor[HTML]{EFEEF1} 67.50  & \cellcolor[HTML]{3972BC} 97.50  & \cellcolor[HTML]{F6F3F4} 66.25 & \cellcolor[HTML]{C3706E} 1927.50 & \cellcolor[HTML]{A7B6CE} 1301.54 \\
% 			                                                                                      & 32                                                  & \cellcolor[HTML]{2369BD} 0.04               & \cellcolor[HTML]{A9373B} 111.62             & \cellcolor[HTML]{E2E3EA} 99.00               & \cellcolor[HTML]{2369BD} 100.00      & \cellcolor[HTML]{809BC3} 86.25  & \cellcolor[HTML]{A9373B} 38.75  & \cellcolor[HTML]{839DC4} 85.62  & \cellcolor[HTML]{A9373B} 38.75 & \cellcolor[HTML]{A9373B} 2110.88 & \cellcolor[HTML]{F2E0DF} 1598.19 \\
% 			\hline\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Seq. }}}  & 8                                                   & \cellcolor[HTML]{2369BD} 0.07               & \cellcolor[HTML]{BBC5D7} 3.46               & \cellcolor[HTML]{7B98C2} 95.00               & \cellcolor[HTML]{2369BD} 98.00       & \cellcolor[HTML]{6288BD} 95.00  & \cellcolor[HTML]{2369BD} 100.00 & \cellcolor[HTML]{4477BC} 95.00  & \cellcolor[HTML]{2369BD} 97.50 & \cellcolor[HTML]{E9CBC9} 988.64  & \cellcolor[HTML]{2369BD} 637.11  \\
% 			                                                                                      & 16                                                  & \cellcolor[HTML]{2369BD} 0.07               & \cellcolor[HTML]{EFDAD8} 6.96               & \cellcolor[HTML]{FAF5F5} 90.00               & \cellcolor[HTML]{F4E3E2} 89.00       & \cellcolor[HTML]{6E90BF} 93.75  & \cellcolor[HTML]{93A8C8} 90.00  & \cellcolor[HTML]{98ACC9} 86.25  & \cellcolor[HTML]{A3B4CD} 85.00 & \cellcolor[HTML]{C06A68} 1173.44 & \cellcolor[HTML]{B3BFD3} 785.97  \\
% 			                                                                                      & 32                                                  & \cellcolor[HTML]{2369BD} 0.08               & \cellcolor[HTML]{A9373B} 13.62              & \cellcolor[HTML]{F4E3E2} 89.00               & \cellcolor[HTML]{A9373B} 84.00       & \cellcolor[HTML]{EFDAD8} 76.25  & \cellcolor[HTML]{A9373B} 64.38  & \cellcolor[HTML]{D7A09D} 66.88  & \cellcolor[HTML]{A9373B} 59.38 & \cellcolor[HTML]{A9373B} 1277.91 & \cellcolor[HTML]{E3BDBB} 1013.90 \\
% 			\midrule
% 			\bottomrule
% 		\end{tabular}
% 	}
% 	\caption{Performance of different planner modules with the scalability in the number of agents ($N$) and specification complexity for the DubinsCar Environment.
% 		%	\SJ{The cells with the dark blue colors are not readable.  Define units: seconds for planning and TtR and for success rate}
% 	}
% 	\label{tab:dubins-spec-v-n-results}
% \end{table*}




%\paragraph{The effect of STL in a Multi-Agent System}
%We note while prioritizing safety over performance the safety rate is 100\%, but the finish rate is suboptimal and the agents are not able to satisfy the specification in part due to deadlocks between the agents and conflicting objectives. 
%On the other hand, while prioritizing performance over safety, the finish rate is higher, at the cost of safety.
%This indicates that a delicate balance between safety and performance is necessary to ensure that the agents are able to satisfy the specifications while avoiding collisions.
%Our learning based approach is able to achieve this balance by co-learning the planner and control policies.
\begin{table*}[t!]
\small
	\centering
	\scalebox{0.7}{
		\begin{tabular}{l|l|cc|cc||cc||cc}
			\toprule
			                                   \multicolumn{2}{c|}{Metric}                                          & \multicolumn{2}{c|}{Finish Rate (\%) $\uparrow$} & \multicolumn{2}{c||}{Safety Rate (\%) $\uparrow$} & \multicolumn{2}{c||}{Success Rate (\%) $\uparrow$} & \multicolumn{2}{c}{TtR  (steps) $\downarrow$}                                               \\
			\midrule
			\multirowcell{2}{\shortstack{Spec}} & \multirowcell{2}{\shortstack{N}}               & \multirowcell{2}{\shortstack{Percentage \\ Change}} &  \multirowcell{2}{\shortstack{ODE}}   & \multirowcell{2}{\shortstack{Percentage \\ Change}} & \multirowcell{2}{\shortstack{ODE}} & \multirowcell{2}{\shortstack{Percentage \\ Change}} & \multirowcell{2}{\shortstack{ODE}} & \multirowcell{2}{\shortstack{Percentage \\ Change}} & \multirowcell{2}{\shortstack{ODE}} \\
			                                                                                                                           &                                             &                                             &                                              &                                       &        &        &        &        &         \\
%			\midrule
			\hline
			\multirow[t]{3}{*}[-1.2em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Branch}}} & 8 & -2.00 & 98.00 &  0.00 & 100.00 & -2.50 & 97.50 & -26.01 & 527.21 \\
 & 16 & -4.00 & 96.00 & -2.50 & 97.50 & -6.25 & 93.75 & -24.86 & 559.88 \\
 & 32 &  0.00 & 95.00 & -8.78 & 84.38 & -7.08 & 81.88 & -18.18 & 671.66 \\
\hline
\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Cover}}} & 8 &  0.00 & 100.00 &  0.00 & 100.00 &  0.00 & 100.00 & -28.19 & 762.57 \\
 & 16 &  0.00 & 100.00 &  0.00 & 96.25 &  0.00 & 96.25 & -28.58 & 802.95 \\
 & 32 &  0.00 & 99.00 &  7.35 & 91.25 &  7.40 & 90.62 & -28.48 & 895.88 \\
\hline
\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Loop}}} & 8 &  0.00 & 100.00 &  0.00 & 100.00 &  0.00 & 100.00 & -16.30 & 1568.57 \\
 & 16 &  0.00 & 100.00 & -11.54 & 86.25 & -11.54 & 86.25 & -17.11 & 1601.03 \\
 & 32 &  0.00 & 99.00 &  0.00 & 86.25 &  0.74 & 86.25 & -13.85 & 1818.59 \\
\hline
\multirow[t]{3}{*}[-1em]{\STAB{\rotatebox[origin=c]{90}{\footnotesize Seq.}}} & 8 & -26.32 & 70.00 &  5.26 & 100.00 & -26.32 & 70.00 &  31.34 & 1298.50 \\
 & 16 & -32.22 & 61.00 & -1.33 & 92.50 & -28.99 & 61.25 &  15.30 & 1352.94 \\
 & 32 & -47.19 & 47.00 &  26.23 & 96.25 & -28.98 & 47.50 &  7.54 & 1374.23 \\
			\midrule
			\bottomrule
		\end{tabular}
	}
	\caption{Considering an ablation without the GNN module for the DubinsCar Environment at various scales and reporting the percentage change in values. Planning times are comparable.
 % \zk{Do we need to report the percentage change in planning time? They are pretty close, but if report the percentage, it looks like sometimes ODE is much better (50\%) than GNN-ODE. Maybe we only need to mention the planning time number in text, and remove this column from the table. }
 % \zk{Why does ODE have a significantly better TtR? Do we need to explain this somewhere?} % \joe{explained in last line}
 } 
	\label{tab:dubins-ode-ablation}
\end{table*}
