%Version 3 October 2023
% See section 11 of the User Manual for version history
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                 %%
%% Please do not use \input{...} to include other tex files.       %%
%% Submit your LaTeX manuscript as one .tex document.              %%
%%                                                                 %%
%% All additional figures and files should be attached             %%
%% separately and not embedded in the \TeX\ document itself.       %%
%%                                                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%\documentclass[referee,sn-basic]{sn-jnl}% referee option is meant for double line spacing

%%=======================================================%%
%% to print line numbers in the margin use lineno option %%
%%=======================================================%%

%%\documentclass[lineno,sn-basic]{sn-jnl}% Basic Springer Nature Reference Style/Chemistry Reference Style

%%======================================================%%
%% to compile with pdflatex/xelatex use pdflatex option %%
%%======================================================%%

%%\documentclass[pdflatex,sn-basic]{sn-jnl}% Basic Springer Nature Reference Style/Chemistry Reference Style


%%Note: the following reference styles support Namedate and Numbered referencing. By default the style follows the most common style. To switch between the options you can add or remove �Numbered� in the optional parenthesis. 
%%The option is available for: sn-basic.bst, sn-vancouver.bst, sn-chicago.bst%  
 
%%\documentclass[sn-nature]{sn-jnl}% Style for submissions to Nature Portfolio journals
%%\documentclass[sn-basic]{sn-jnl}% Basic Springer Nature Reference Style/Chemistry Reference Style
%%\documentclass[sn-mathphys-num]{sn-jnl}% Math and Physical Sciences Numbered Reference Style 
\documentclass[sn-mathphys-ay, iicol]{sn-jnl}% Math and Physical Sciences Author Year Reference Style
%%\documentclass[sn-aps]{sn-jnl}% American Physical Society (APS) Reference Style
%%\documentclass[sn-vancouver,Numbered]{sn-jnl}% Vancouver Reference Style
%%\documentclass[sn-apa]{sn-jnl}% APA Reference Style 
%%\documentclass[sn-chicago]{sn-jnl}% Chicago-based Humanities Reference Style

%%%% Standard Packages
%%<additional latex packages if required can be included here>

\usepackage{graphicx}%
\usepackage{multirow}%
\usepackage{amsmath,amssymb,amsfonts}%
\usepackage{amsthm}%
\usepackage{mathrsfs}%
\usepackage[title]{appendix}%
\usepackage{xcolor}%
\usepackage{textcomp}%
\usepackage{manyfoot}%
\usepackage{booktabs}%
\usepackage{algorithm}%
\usepackage{algorithmicx}%
\usepackage{algpseudocode}%
\usepackage{listings}%
%%%%

%%%%%=============================================================================%%%%
%%%%  Remarks: This template is provided to aid authors with the preparation
%%%%  of original research articles intended for submission to journals published 
%%%%  by Springer Nature. The guidance has been prepared in partnership with 
%%%%  production teams to conform to Springer Nature technical requirements. 
%%%%  Editorial and presentation requirements differ among journal portfolios and 
%%%%  research disciplines. You may find sections in this template are irrelevant 
%%%%  to your work and are empowered to omit any such section if allowed by the 
%%%%  journal you intend to submit to. The submission guidelines and policies 
%%%%  of the journal take precedence. A detailed User Manual is available in the 
%%%%  template package for technical guidance.
%%%%%=============================================================================%%%%

%% as per the requirement new theorem styles can be included as shown below
\theoremstyle{thmstyleone}%
\newtheorem{theorem}{Theorem}%  meant for continuous numbers
%%\newtheorem{theorem}{Theorem}[section]% meant for sectionwise numbers
%% optional argument [theorem] produces theorem numbering sequence instead of independent numbers for Proposition
\newtheorem{proposition}[theorem]{Proposition}% 
%%\newtheorem{proposition}{Proposition}% to get separate numbers for theorem and proposition etc.

\theoremstyle{thmstyletwo}%
\newtheorem{example}{Example}%
\newtheorem{remark}{Remark}%

\theoremstyle{thmstylethree}%
\newtheorem{definition}{Definition}%

\raggedbottom
%%\unnumbered% uncomment this for unnumbered level heads

%%%%%%% my imports

\usepackage{times}
\usepackage{booktabs}
\usepackage{tablefootnote}

\usepackage{float}

\usepackage[binary-units=true]{siunitx}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}

\usepackage{graphicx}

\usepackage{amssymb}% http://ctan.org/pkg/amssymb
\usepackage{pifont}% http://ctan.org/pkg/pifont

\usepackage{makecell}

\usepackage{wrapfig}

\usepackage{algorithm}
\usepackage{algpseudocode}

% from https://people.inf.ethz.ch/markusp/teaching/guides/guide-tables.pdf
\usepackage{booktabs}
\newcommand{\ra}[1]{\renewcommand{\arraystretch}{#1}}

\usepackage{makecell}

\usepackage{pgfplots}
\usepackage{tikz}

\usepackage{float}

\usepackage{enumitem}


\usepgfplotslibrary{external}
\usetikzlibrary{shapes}
\usetikzlibrary{positioning}
\usetikzlibrary{arrows,decorations.markings}
\usetikzlibrary{calc,spy,shapes}
\usetikzlibrary{shapes}
\usepgfplotslibrary{fillbetween}

\usetikzlibrary{pgfplots.groupplots}
\usetikzlibrary{patterns}

\usepackage{caption}

\usepackage{subcaption}

\renewcommand\theadalign{bc}
\renewcommand\theadfont{\bfseries}
\renewcommand\theadgape{\Gape[4pt]}
\renewcommand\cellgape{\Gape[4pt]}

\usepackage{xcolor}
\definecolor{applegreen}{rgb}{0.55, 0.9, 0.0}
\definecolor{amaranth}{rgb}{0.9, 0.17, 0.31}

\newtheorem*{theorem-non}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{assumption}{Assumption}

\newcommand{\fillopacity}{0.4}
\newcommand{\colordarkgreen}{green!50!black}
\newcommand{\colordarkblue}{blue!50!black}
\newcommand{\colordarkred}{blue!50!black}

\newcommand{\lwboxplot}{0.7pt}

\newcommand{\emphkey}[1]{\textbf{#1}}

\newcommand{\myswarm}{\textsc{DMPC-Swarm}}

\newcommand{\cmarkgreen}{\textcolor{green!70!black}{\textbf{\large\cmark}}}
\newcommand{\xmarkred}{\textcolor{red!70!black}{\textbf{\large\xmark}}}

\newcommand{\opindent}{\phantom{=}}

\newcommand{\reviewerone}[1]{#1}
\newcommand{\reviewertwo}[1]{#1}
\newcommand{\reviewerthree}[1]{#1}
\newcommand{\reviewerall}[1]{#1}

\usepackage{ifthen}
	\newboolean{authnotes}
	\setboolean{authnotes}{true}
	% \setboolean{authnotes}{false}

\ifthenelse{\boolean{authnotes}}
% if the boolean authnotes is true define the macros
{
\newcommand{\thought}[1]{{\color[rgb]{0.2,0.39,0.66}(#1)}}
\newcommand{\todo}[1]{{\color[rgb]{1.0,0.0,0.0}(#1)}}
\newcommand{\fm}[1]{\footnote{{\bf\color{blue} Fabian: #1}}}
\newcommand{\mz}[1]{\footnote{{\bf\color{orange!50!black} Marco: #1}}}
\newcommand{\st}[1]{\footnote{{\bf\color{green!50!black} Sebastian: #1}}}
\newcommand{\ag}[1]{\footnote{{\bf\color{red!50!black} Alexander: #1}}}
}
% otherwise, just define the macros to avoid compilation errors, but ignore
% the content of the notes
{
\newcommand{\thought}[1]{}
\newcommand{\todo}[1]{}
\newcommand{\fm}[1]{}
\newcommand{\mz}[1]{}
\newcommand{\st}[1]{}
\newcommand{\ag}[1]{}
}



%%%%%%%%%%%Makros%%%%%%%%%%%%%%%%%
\newcommand{\capt}[1]{\mdseries{\emph{#1}}}
\newcommand{\cone}[0]{\textbf{C1)}}
\newcommand{\ctwo}[0]{\textbf{C2)}}
\newcommand{\cthree}[0]{\textbf{C3)}}
\newcommand{\cfour}[0]{\textbf{C4)}}

\newcommand{\safetyguarnum}[0]{\textbf{R1}}
\newcommand{\distcontrnum}[0]{\textbf{R2}}
\newcommand{\reseffnum}[0]{\textbf{R3}}

% \newcommand{\compdistrcomp}[0]{\hyperref[comp:distrcomp]{\textbf{C1}}}
% \newcommand{\compcom}[0]{\hyperref[comp:com]{\textbf{C2}}}
% \newcommand{\compmlr}[0]{\hyperref[comp:mlr]{\textbf{C3}}}



\newcommand{\distcontr}[0]{\emphkey{distributed control}}
\newcommand{\safetyguar}[0]{\emphkey{safety guarantees}}
\newcommand{\reseff}[0]{\emphkey{resource efficiency}}

\newcommand{\distcontrc}[0]{\emphkey{Distributed control}}
\newcommand{\safetyguarc}[0]{\emphkey{Safety guarantees}}
\newcommand{\reseffc}[0]{\emphkey{Resource efficiency}}

\newcommand{\distcontrcc}[0]{\emphkey{Distributed Control}}
\newcommand{\safetyguarcc}[0]{\emphkey{Safety Guarantees}}
\newcommand{\reseffcc}[0]{\emphkey{Resource Efficiency}}

\newcommand{\ul}[1]{_\mathrm{#1}}
\newcommand{\uli}[1]{_{#1}}

\newcommand{\fakepar}[1]{\vspace{2mm}\noindent\textbf{#1}}




\newcommand{\cmark}{\textcolor{applegreen!80!black}{\ding{51}}}%
\newcommand{\xmark}{\textcolor{amaranth!80!black}{\ding{55}}}%


\pgfplotsset{
	box plot/.style={
		/pgfplots/.cd,
		black,
		only marks,
		mark=-,
		mark size=\pgfkeysvalueof{/pgfplots/box plot width},
		/pgfplots/error bars/y dir=plus,
		/pgfplots/error bars/y explicit,
		/pgfplots/table/x index=\pgfkeysvalueof{/pgfplots/box plot x index},
	},
	box plot box/.style={
		/pgfplots/error bars/draw error bar/.code 2 args={%
			\draw  ##1 -- ++(\pgfkeysvalueof{/pgfplots/box plot width},0pt) |- ##2 -- ++(-\pgfkeysvalueof{/pgfplots/box plot width},0pt) |- ##1 -- cycle;
		},
		/pgfplots/table/.cd,
		y index=\pgfkeysvalueof{/pgfplots/box plot box top index},
		y error expr={
			\thisrowno{\pgfkeysvalueof{/pgfplots/box plot box bottom index}}
			- \thisrowno{\pgfkeysvalueof{/pgfplots/box plot box top index}}
		},
		/pgfplots/box plot
	},
	box plot top whisker/.style={
		/pgfplots/error bars/draw error bar/.code 2 args={%
			\pgfkeysgetvalue{/pgfplots/error bars/error mark}%
			{\pgfplotserrorbarsmark}%
			\pgfkeysgetvalue{/pgfplots/error bars/error mark options}%
			{\pgfplotserrorbarsmarkopts}%
			\path ##1 -- ##2;
		},
		/pgfplots/table/.cd,
		y index=\pgfkeysvalueof{/pgfplots/box plot whisker top index},
		y error expr={
			\thisrowno{\pgfkeysvalueof{/pgfplots/box plot box top index}}
			- \thisrowno{\pgfkeysvalueof{/pgfplots/box plot whisker top index}}
		},
		/pgfplots/box plot
	},
	box plot bottom whisker/.style={
		/pgfplots/error bars/draw error bar/.code 2 args={%
			\pgfkeysgetvalue{/pgfplots/error bars/error mark}%
			{\pgfplotserrorbarsmark}%
			\pgfkeysgetvalue{/pgfplots/error bars/error mark options}%
			{\pgfplotserrorbarsmarkopts}%
			\path ##1 -- ##2;
		},
		/pgfplots/table/.cd,
		y index=\pgfkeysvalueof{/pgfplots/box plot whisker bottom index},
		y error expr={
			\thisrowno{\pgfkeysvalueof{/pgfplots/box plot box bottom index}}
			- \thisrowno{\pgfkeysvalueof{/pgfplots/box plot whisker bottom index}}
		},
		/pgfplots/box plot
	},
	box plot median/.style={
		/pgfplots/box plot,
		/pgfplots/table/y index=\pgfkeysvalueof{/pgfplots/box plot median index}
	},
	box plot width/.initial=1em,
	box plot x index/.initial=0,
	box plot median index/.initial=1,
	box plot box top index/.initial=2,
	box plot box bottom index/.initial=3,
	box plot whisker top index/.initial=4,
	box plot whisker bottom index/.initial=5,
}

\newcommand{\boxplot}[2][]{
	\addplot [box plot median,#1] table {#2};
	\addplot [forget plot, box plot box,#1] table {#2};
	\addplot [forget plot, box plot top whisker,#1] table {#2};
	\addplot [forget plot, box plot bottom whisker,#1] table {#2};
}

%%%%%%%%%%%%%%%%% END OF PREAMBLE %%%%%%%%%%%%%%%%

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{} % clear all header fields
\fancyhead[C]{\small\textit{Accepted for publication at Springer Autonomous Robots}}


\begin{document} 
% {\onecolumn \begin{center} Accepted for publication at Springer Autonomous Robots\end{center}
% }
% \twocolumn
% 		\newpage

\title[DMPC-Swarm: Distributed Model Predictive Control on Nano UAV swarms]{DMPC-Swarm: Distributed Model Predictive Control on Nano UAV Swarms}

\author*[1]{\fnm{Alexander} \sur{Gräfe}}\email{alexander.graefe@dsme.rwth-aachen.de}

\author[1]{\fnm{Joram} \sur{Eickhoff}}\email{joram.eickhoff@dsme.rwth-aachen.de}

\author[2]{\fnm{Marco} \sur{Zimmerling}}\email{marco.zimmerling@tu-darmstadt.de}

\author[1]{\fnm{Sebastian} \sur{Trimpe}}\email{trimpe@dsme.rwth-aachen.de}

\affil[1]{\orgdiv{Institute for Data Science in Mechanical Engineering}, \orgname{RWTH Aachen University}, \orgaddress{\street{Theaterstraße 35-39}, \city{Aachen}, \postcode{52062}, \country{Germany}}}

\affil[2]{\orgdiv{Networked Embedded Systems Lab}, \orgname{TU Darmstadt}, \orgaddress{\street{Mornewegstraße 30}, \city{Darmstadt}, \postcode{64293}, \country{Germany}}}



\input{chapter/abstract.tex}
\keywords{Robot Swarms, Safety, Collision Avoidance, Distributed Control}

\maketitle

% }
% \twocolumn
% \input{chapter/abstract.tex}



% In setting up this template for *Science* papers, we've used both
% the \section* command and the \paragraph* command for topical
% divisions.  Which you use will of course depend on the type of paper
% you're writing.  Review Articles tend to have displayed headings, for
% which \section* is more appropriate; Research Articles, when they have
% formal topical divisions at all, tend to signal them with bold text
% that runs into the paragraph, for which \paragraph* is the right
% choice.  Either way, use the asterisk (*) modifier, as shown, to
% suppress numbering.
\clearpage
%\section*{Introduction}
%\begin{enumerate}
%	\item Robot swarm challenges
%	\begin{enumerate}
%		\item \textbf{C1)} Information exchange (widespread, mobile (UAVs themselves + infrastructure), reliable)
%		\item \textbf{C2)} Distributed decision making (information structure)
%		\item \textbf{C3)} Adaptivity (UAVs join/leave the network)
%		\item \textbf{C4)} Safety $\rightarrow$ Theoretical guarantees. In particular challenging due to system complexity. Caused by integrating C1)-C3) in a real robot swarm. \cite{zhou2022swarm} state guarantees are impossible.	\end{enumerate}
%	\item Related work $\rightarrow$ none that does all.
%	\item \textbf{Proposal/method}
%	\begin{enumerate} \item Communication/algorithm codesign.
%	\begin{enumerate}
%		\item design philosophy
%		\item leads to cyber physical architecture (Mixer, heterogeneous computing architecture, event-triggering)
%	\end{enumerate}
%	\item Together they solve C1)-C3).
%	\item Codesign is basis for C4). However guarantees setting specific.
%	\item We will show how C4) can be achieved on relevant design example. DMPC for trajectory planning.
%	\item First time: DMPC for trajectory planning implemented on a real swarm with real communication.
%	\end{enumerate}
%\end{enumerate}
%\section*{Results}
%\begin{enumerate}
%	\item \textbf{Hardware-results} (videos + plots)
%	\begin{enumerate}
%		\item \textbf{C1)}: 2 separated swarms, on in the lab, one above in our office, move with CUs between swarms.
%		\item \textbf{C2)}: Formation flight using DMPC, a lot of drones in testbed.
%		\item \textbf{C3)}: Adding/removing drones 
%	\end{enumerate}
%	\item Model/simulation match reality $\rightarrow$ Basis for \textbf{C4)}
%	\item \textbf{C4):} Theorem (DMPC) (Light version). Because model matches real world guarantees transfer.
%	\item Show message loss cannot be be ignored in DMPC with simulation study.
%	\item everything open source.
%\end{enumerate}
%
%\section*{Discussion}
%\begin{enumerate}
%	\item Guarantees through codesign. Theory in accordance with real world. Guarantees in theory transfer to real world.
%	\item Simulation shows MLR is important. Message loss cannot be ignored.
%	\item What effect has the communication system on performance and what can be done on communication side to enhance the performance?
%	\item What effect has the control side on the performance and what can be done on control side?
%\end{enumerate}
%\clearpage
%-------------------------------- content ---------------------------------
% \section*{Summary}
% This paper presents \textsc{SafeSwarm}, the first flying robot swarm architecture and hardware implementation that combines collision avoidance guarantees, distributed control and resource-efficient communication and computation.
% This paper presents the first combination of a trajectory planning algorithm with guarantees under message loss based on distributed model predictive control and evaluation on a quadcopter swarm with a real ad-hoc communication network.

\input{chapter/introduction.tex}
\input{chapter/related_work.tex}
\input{chapter/materials_methods.tex}
\input{chapter/results.tex}
\input{chapter/discussion.tex}



\section*{Acknowledgments}
This work was supported by the German Research Foundation (DFG) within the priority program 1914 (grant TR 1433/2) and within the Emmy Noether project NextIoT (ZI 1635/2-1), and by the LOEWE initiative (Hesse, Germany) within the emergenCITY center (LOEWE/1/12/519/03/05.001(0016)/72). 

The authors gratefully acknowledge the computing time provided to them at the NHR Center NHR4CES at RWTH Aachen University (p0022034). This is funded by the Federal Ministry of Education and Research, and the state governments participating on the basis of the resolutions of the GWK for national high performance computing at universities (www.nhr-verein.de/unsere-partner).

We thank Sebastian Giedyk for his help with the quadcopters and the testbed, and Shengsi Xu for his help with the software development for the experiments, and Fabian Mager, Henrik Hose, Alexander von Rohr and Pierre-François Massiani for helpful discussions.

\bibliography{references}

\begin{appendices}

\input{chapter/supplementary_material.tex}

\end{appendices}
%Materials and Methods\\
%Supplementary Text\\
%Figs. S1 to S3\\
%Tables S1 to S4\\
%References \textit{(4-10)}


\end{document}
