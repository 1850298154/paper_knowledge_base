%!TEX root = ../scifile.tex


\input{chapter/HardwareExperimentsFigure}

\begin{figure*}[t]
    \centering
    \includegraphics[width=0.99\textwidth]{Images/DMPCvsMLRDMPC.pdf}
    \caption{Comparison of MLR-DMPC with DMPC ignoring message loss. \capt{Sixteen UAVs fly to the opposite side of a circle. We jam the wireless channel for the first two seconds. Using existing methods~\citep{Graefe2022} that ignore message loss, the UAVs crash. With MLR-DMPC, the UAVs remain safe. A video of the maneuver is available at \url{http://tiny.cc/DMPCSwarmMessageLoss}.}}
    % \caption{Comparison of MLR-DMPC with DMPC ignoring message loss. \capt{16 UAVs must fly to the opposite side of the circle. For the first two seconds, we jam the wireless channel. Using existing methods~\citep{Graefe2022} ignoring message loss, the UAVs crash. Using MLR-DMPC, the UAVs remain safe. A video of the maneouver is available at: \url{http://tiny.cc/DMPCSwarmMessageLoss}.}}
    \label{fig:hardware:dmpcvsmlrdmpc}
\end{figure*}

\section{Experimental Results}
\label{sec:experiments}
% In this section, we demonstrate that \myswarm{} can safely control real UAV swarms using DMPC. Throughout our experiments, the swarm transitions between formations: each UAV flies from its collision-free initial configuration to specified target positions.
% We first evaluate \myswarm{} through hardware experiments. 
% Subsequently, we conduct simulations to analyze important hyperparameters, particularly the number of CUs and the choice of event-trigger mechanisms. 
% This approach allows us to explore a wider range of scenarios than possible with hardware experiments, leading to results with higher statistical significance.
% Additionally, simulations lower the barrier for further research, enabling others to reproduce and build upon our results.

% \subsection{Hardware Experiments}

% \begin{figure}
%     \centering
%     \includegraphics[width=0.9\linewidth]{Images/Movie1Thumbnail.pdf}
%     \caption*{Movie 1. \capt{This video provides an overview of our hardware implementation. We present multiple maneuvers flown by the swarm. \url{http://tiny.cc/DMPCSwarm}}}
% \end{figure}


We demonstrate \myswarm's ability to safely control real UAV swarms using DMPC. Specifically, we present:

\begin{enumerate}
    \item The overall performance of \myswarm{} as the first implementation of DMPC with distributed computation and wireless communication (Section~\ref{sec:experiments:mainresult}).
    \item An evaluation of \myswarm{}'s distributed event-triggered computation architecture (Section~\ref{sec:experiments:distrcomp}).
    \item \myswarm{}'s robustness under message loss (Section~\ref{sec:experiments:messageloss}).
\end{enumerate}


\subsection{Experimental Setup}
\label{sec:method:hardware}

Using the described architecture as a base, we achieve a distributed DMPC implementation (see Figure~\ref{fig:hardwareimplementation}). 
It includes 16 Crazyflie~2.1 quadcopters and three laptops as CUs, which could correspond to end-user devices in an application scenario.
All devices are equipped with nRF52840 \SI{2}{\mega\bit\per\second} BLE transceivers running Mixer.

The swarm operates within a $3.4 \times 3.4 \times 2.6$~\SI{}{\meter} obstacle-free space. 
A Vicon motion capture system with Crazyswarm~\citep{preiss2017crazyswarm} provides position measurements, which in real application could be substituted by distributed solutions such as Ultra-Wideband or GPS localization.

\reviewerone{We chose $\hat{d}_\mathrm{min}=\SI{0.25}{\meter}$ through experimentation.
We began with $\hat{d}_\mathrm{min}=\SI{0.35}{\meter}$ from~\cite{Luis2019}. 
Through further testing, we found that reducing the distance to $\hat{d}_\mathrm{min}=\SI{0.25}{\meter}$ allowed the swarm to operate reliably. 
Distances smaller than this proved unfeasible not due to physical collisions between UAVs, but because rotor-generated turbulence reduced lift, leading to drones crashing into the ground unexpectedly.}

By positioning the CUs approximately 15 meters apart and separating them with a concrete wall to prevent direct communication, the network has at least two hops. 
The MLR-DMPC frequency is \SI{5}{\hertz} ($T_\mathrm{calc} = \SI{105}{\milli\second}$, $T_\mathrm{com}=\SI{95}{\milli\second}$), while the Crazyflies' low-level control runs at \SI{500}{\hertz}. 
%We will release the experimental code upon acceptance.

\subsection{Performance of \myswarm{}}
\label{sec:experiments:mainresult}
%, with experiments where the swarm transitions between formations as each UAV flies from its initial configuration to specified target positions.
Our video (\url{http://tiny.cc/DMPCSwarm}) showcases key experimental outcomes, including various swarm maneuvers. 
It demonstrates that \myswarm{} successfully implements DMPC-based swarm control in hardware, executing the entire DMPC algorithm in a distributed manner across the quadcopters and CUs.

Despite challenges such as changing wireless properties due to robot movement, communication among up to 27 devices in a mesh network, and interference from external Wi-Fi and Bluetooth devices, the communication network remains functional and all devices stay synchronized.  
The event-trigger mechanism enables dynamic swarm control while conserving resources, even when there are more drones than CUs. 
Importantly, no collisions occur during any maneuvers, despite network latency and message loss.

% In the following, we use this hardware implementation to evaluate \myswarm{} with respect to distributed event-triggered computation and robustness under message loss---both key features of our swarm.

% Distributed and communication, is evaluated in parallel, as during our experiments, the swarm communicates via Mixer.

% For an in-depth analysis of Mixer, we refer to its original paper~\cite{Mixer}.


\subsection{Distributed Event-Triggered Computation}
\label{sec:experiments:distrcomp}

We evaluated our approach through two experiments: (1) examining the influence of the number of CUs (i.e., available computational power), and (2) assessing the effect of the event trigger on swarm performance. 
Both experiments used the same setup (Figure~\ref{fig:hardware:distrcomp:maneouver}): 16 quadcopters underwent multiple formation changes, starting from a planar configuration and sequentially forming a pyramid, cube, sphere, and finally returning to the original plane. 
Results are presented in Figure~\ref{fig:hardware:distrcomp} and in a video (\url{http://tiny.cc/DMPCSwarmComputation}).

% We evaluate our approach through two experiments: first, examining the influence of the number of CUs (i.e., available computational power), and second, assessing the effect of the event-trigger on swarm performance. 
% Both experiments use the same setup (Figure~\ref{fig:hardware:distrcomp:maneouver}): 16 quadcopters undergo multiple formation changes, starting from a planar configuration, sequentially forming a pyramid, cube, sphere, and finally returning to the original plane. 
% Results are presented in Figure~\ref{fig:hardware:distrcomp} and in our video (\url{http://tiny.cc/DMPCSwarmComputation}).

\fakepar{Number of CUs}
We control the swarm using one, two, and three CUs. As shown in Figure~\ref{fig:hardware:distrcomp:numcu}, increasing the number of CUs accelerates the formation changes. 
The most significant improvement occurs when increasing from one to two CUs, while adding a third CU yields diminishing returns. 
Thus, adding computational power enhances swarm performance.

Using fewer CUs conserves resources but reduces performance; the extent of this trade-off depends on the number of CUs.
%Our experiments indicate that reducing the number of CUs from two to one has a greater impact than reducing from three to two. 
%Our simulation study further investigates this effect and shows that under certain conditions, adding more CUs does not necessarily improve performance.

\fakepar{Event-Trigger}
We can influence swarm performance by choosing how event-trigger priorities are calculated (cf.\ Section~\ref{sec:mlrdmpc:algorithm:eventtrigger})~\citep{Graefe2022}. We compare RR, DB and HT.

Figure~\ref{fig:hardware:distrcomp:et} presents the results. 
In three of the four formations, the swarm using RR is the slowest to reach targets because RR often assigns resources to agents already at their targets. 
DB and HT generally exhibit similar performance across formations. 
With HT, some quadcopters reach targets earlier than others; with DB, all quadcopters reach targets at approximately the same time, as DB exclusively assigns resources to those farthest from their targets.

The event-trigger enables dynamic control of the swarm, even with many more drones than CUs. 
Selecting the appropriate event-trigger is crucial for achieving optimal performance.


\subsection{Robustness under Message Loss}
\label{sec:experiments:messageloss}

To highlight the importance of \myswarm{}'s collision avoidance under message loss, we compare MLR-DMPC with a DMPC that does not account for message loss~\citep{Graefe2022}.

In this experiment, sixteen quadcopters controlled by three CUs exchange their positions along a circle's circumference (see Figure~\ref{fig:hardware:dmpcvsmlrdmpc} and \url{http://tiny.cc/DMPCSwarmMessageLoss}). 
To make our experiment reproducable, we simulate a jammed communication channel, introducing a two-second period during which the CUs experience message loss---they can transmit but cannot receive data.

We conduct the experiment twice: first with CUs running MLR-DMPC, then with standard DMPC. 
With standard DMPC, two quadcopters collide, causing the swarm to fail its task. 
In contrast, under MLR-DMPC control, all quadcopters remain safe and successfully exchange positions without collision, demonstrating the critical role of our MLR module.

\reviewerone{We note that \myswarm{} would have been safe for arbitrarily long message-loss periods. In this case, the UAVs would have come safely to a halt after the length of the MPC's prediction horizon.}

% \clearpage

% \subsection{Simulations Study}

% \input{chapter/SimulationExperimentsFigure}

% In the previous section, we have shown that \myswarm{} achieves its main goal: implementing DMPC on distributed hardware. 
% We now complement this with a simulation study to further investigate its properties across thousands of setups, which would be impractical to test on hardware.

% Our simulation study uses \textit{gym-pybullet-drones}~\cite{panerati2021learning} to simulate Crazyflie dynamics, assuming that two UAVs collide when their separation distance falls below $d_\mathrm{min} = \SI{0.1}{\meter}$. 
% We also simulate wireless communication using synchronized many-to-all communication as a simple yet accurate model. 
% For every data point presented, we conducted 3000 simulation runs with randomly assigned starting and target positions for the quadcopters.


% \subsubsection{Distributed Computation}

% In the hardware experiments, we investigated a limited set of scenarios.
% To generalize our findings regarding number of CUs and choice of event-trigger, we now extend this analysis to a broader range of scenarios.

% \fakepar{Number of CUs.}
% This section examines the effect of the number of CUs across various maneuvers and under different message loss probabilities.
% We simulate swarms of 10 and 16~UAVs for different numbers of CUs and message loss probabilities shown in Figure~\ref{fig:simulation:distrcomp}.
% Here, we differentiate between low and high message loss probabilities setups.

% \emph{Low message loss probabilities ($\leq\SI{1}{\percent}$).}
% We observe the same behavior as in the hardware experiments, shown in Figure~\ref{fig:simulation:distrcomp:et}. 
% Adding one CU to a low number of CUs has a more pronounced effect on performance than adding one CU to a higher number of CUs.
% At a certain point, adding more CUs can even degrade performance. This degradation occurs for two main reasons:
% First, when the number of CUs exceeds half the number of UAVs, they do not lead to more simultaneously calculated trajectories, a property of MLR-DMPC, while the communication latency increases due to increased network traffic.
% Second, with fewer CUs, we can relax the constraints in the trajectory optimization problem, which counteracts the effect of fewer UAVs receiving a new trajectory per round.

% Consequently, optimal performance does not require the same number of CUs as UAVs.
% For example, ten UAVs reach optimal performance with three CUs, while a swarm of 16 performs best with five CUs.
% \myswarm{}{} can thus conserve hardware and bandwidth by using fewer CUs, with only a minor degradation of performance.
% In some cases, reducing the number of CUs even results in performance gain.

% \emph{High message loss probabilities ($>\SI{1}{\percent}$).} 
% This effect is even more significant for high message loss probabilities, as Figures~\ref{fig:simulation:distrcomp:arrivaltime} and~\ref{fig:simulation:distrcomp:targetsreached} illustrate.
% In these scenarios, the swarm's performance drastically falls with increasing number of CUs.
% The UAVs need longer to reach their targets, and fewer of them reach their targets within \SI{200}{\second}, the maximum simulated time.
% The reason for this is the MLR.
% The more CUs, the higher the probability that a CU experiences message loss and has to activate the MLR, i.e., it does not calculate a trajectory.
% Therefore, we can save hardware and improve performance by using fewer CUs.
% It should be noted that scenarios with high message loss probability are relatively rare in our hardware implementation, e.g., when the channel is jammed.
% Typically, Mixer has a very high reliability with message loss probabilities far below \SI{1}{\percent}~\cite{Mixer,PredictiveTriggering}.

% \fakepar{Event-trigger.}
% Figure~\ref{fig:simulation:distrcomp:et} compares different event-triggers with respect to the arrival times of the UAVs in simulation for a message loss probability of \SI{1}{\percent}.
% The HT performs best for some numbers of CUs, while in other cases the DT performs better.
% % We observed that the HT performs better in symmetrical scenarios that are prone to deadlocks. This is because the DT repeatedly selects UAVs that are stuck and unable to move, whereas the HT also selects other UAVs, creating space and resolving the deadlock.
% The RR generally performs worse than both DT and HT because it periodically selects UAVs that have already reached their targets and do not need any computation.
% Selecting the right event-trigger is thus vital for good swarm performance.
% Different event-triggers may be optimal for different scenarios, with the simulation setup and results presented here providing pointers on which trigger to select.


% \subsubsection{MLR-DMPC}

% As in the hardware experiments, we compare the performance of DMPC with MLR-DMPC.
% However, instead of artificially jamming the channel, we consider random message loss.
% We simulate swarms of 10 and 16 UAVs under varying message loss probabilities, displayed in Figure~\ref{fig:simulation:dmpcvsmlrdmpc}.

% Even for a message loss probability as low as \SI{1}{\percent}, i.e., one of every 100 messages is lost on average, DMPC ignoring message loss leads to collisions.
% The higher the message loss probability, the more UAVs crash and the fewer UAVs (down to $\SI{60}{\percent}$) reach their targets.
% One reason for this behavior, besides the collisions, is that many of the optimization problems the CUs try to solve are infeasible (\SI{26.3}{\percent}).
% By contrast, MLR-DMPC steers all quadcopters safely to their targets without collisions, even at message loss probabilities as high as \SI{10}{\percent}.

% These experiments further demonstrate that message loss cannot be neglected, an essential point for guarantees and the swarm's performance.
