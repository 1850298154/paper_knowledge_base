\section{Cutoffs for Disjunctive Systems}
\label{sec:app-disj}

\subsection{Disjunctive Systems without Fairness}

\begin{restatable}[Monotonicity: Disj, Properties, Unfair]{lem}{DisjMonoLemma}
\label{disj:le:NonFairDisjunctiveMono}
    For disjunctive systems:
    \begin{align*}
    &\forall n \geq 1:\\
    &(A,B)^{(1,n)} \models \pexists h(A,B_1)
    \ \Impl \
    (A,B)^{(1,n+1)} \models \pexists h(A,B_1).
    \end{align*}
\end{restatable}
\begin{proof}
Given run $x$ of $(A,B)^{(1,n)}$ we construct a run $y$ of $(A,B)^{(1,n+1)}$: 
copy $x$ into $y$ and keep the additional process in the initial state.
\end{proof}

\begin{restatable}[Bounding: Disj, Properties, Unfair]{lem}{DisjBoundingLemma}
\label{disj:le:NonFairDisjunctiveBounding}
    For disjunctive systems:
    \begin{align*}
    \forall n \geq |B|+2:\ 
    (A,B)^{(1,|B|+2)} \models \pexists h(A,B_1)
    \ \ \Implied \ \ 
    \largesys \models \pexists h(A,B_1).
    \end{align*}
\end{restatable}
\noindent 
The proof is from \cite[Lemma 4.1.2]{Emerson00}. 
We recapitulate it to introduce the notion of ``a process floods a state'', 
\destutter, \interleave, and ``process mimics another process'' 
which are used in our proofs later.
\ak{we could remove the proof and define these notions outside as i did for other constructions}

\input{proof-disj-bounding-new}
%\gray{\ak{previous version is commented out}
% \input{proof-disj-bounding}
%}

\begin{restatable}[Disj, Props, Unfair]{tightness}{TightDisjBoundingLemma}
\label{obs:disj:tight_prop}
    The cutoff in Lemma~\ref{disj:le:NonFairDisjunctiveBounding} is tight, 
    i.e., for any $k$ there exist process templates $(A,B)$ with $|B| = k$ 
    and $\LTLmX$ formula $h(A,B_1)$ such that:
    $$
    (A,B)^{(1,|B|+2)} \models \pexists h(A,B_1) ~~and~~ 
    (A,B)^{(1,|B|+1)} \not\models \pexists h(A,B_1).
    $$
\end{restatable}
\input{tight-disj-bounding}

\ifwithextensions
%\subsubsection{Generalized Bounding Lemma.}

Now, consider properties $h(A,B^{(n)})$ that may talk about ($A$ and) $n$ different copies of process template $B$. 

\begin{restatable}[Generalized Bounding Lemma]{lem}{DisjBoundingLemmaGeneral}
\label{disj:le:NonFairDisjunctiveBoundingGeneral}
For disjunctive systems without fairness:
\begin{align*}
&(A,B)^{(1,\geq \card{B} + k + 1)} \models \pexists h(A,B^{(k)}) &
&~\iff~& &
(A,B)^{(1,\card{B} + k + 1)} \models \pexists h(A,B^{(k)}).%,\\
\end{align*}
\end{restatable}
\input{proof-disj-bounding-general}

\begin{restatable}{obs}{TightDisjBoundingLemmaGeneral}
\label{obs:disj:tight_prop:general}
The cutoffs in Lemma~\ref{disj:le:NonFairDisjunctiveBoundingGeneral} are tight, i.e.,
for any $k$ there exist $(A,B)$ with $\card{B}=k$ and $\LTLmX$ formula $h(A,B^{(n)})$ such that: \sj{do we have example for generalized form?}\ak{agree, proof is needed}
%
$$
(A,B)^{(1,k+n+1))} \models h(A,B^{(n)}) ~~and~~ 
(A,B)^{(1,k+n)} \not\models h(A,B^{(n)}).
$$
\end{restatable}
\input{tight-disj-bounding-general}
\fi  %\ifwithextensions

\begin{restatable}[Monotonicity: Disj, Deadlocks, Unfair]{lem}{mono_lem_disj_deadlocks_unfair}
\label{mono_lem_disj_deadlocks_unfair}
    For disjunctive systems:
    $$\forall n\geq |B|+1: (A,B)^{(1,n)} \textit{ has a deadlock} \ 
    \Impl\ 
    (A,B)^{(1,n+1)} \textit{ has a deadlock}$$
\end{restatable}
\begin{proof}
Given a deadlocked run $x$ of $(A,B)^{(1,n)}$ 
we build a deadlocked run of $(A,B)^{(1,n+1)}$. 
If the run $x$ is locally deadlocked,
then it has at least one infinitely moving process, 
thus let the additional process mimic that process. 
If the run $x$ is globally deadlocked run, 
then due to $n>|B|$ in some state there are at least two processes deadlocked. 
Thus, let the new process mimic a process deadlocked in that state -- 
the run constructed will also be globally deadlocked.
\end{proof}

\sj{should be tight: If we only have $\card{B}$, here is the counterexample: pipeline where transition $(q_i,q_{i+1})$ is guarded with $\exists q_i$, and $(q_{n-1},q_0)$ guarded with $\exists q_{n-1}$. This system has deadlock with up to $n$ processes, but not with $n+1$.}


\begin{restatable}[Bounding: Disj, Deadlocks, Unfair]{lem}{lem_disj_deadlocks_unfair}
\label{lem_disj_deadlocks_unfair}
For disjunctive systems:
\li
  \- with $c=|B|+2$ and any $n>c$:
  $$(A,B)^{(1,c)} \textit{ has a local deadlock} \ \Implied\ (A,B)^{(1,n)} \textit{ has a local deadlock}$$
  
  \- with $c=2|B| - 1$ and any $n>c$
  $$(A,B)^{(1,c)} \textit{ has a global deadlock} \ \Implied\ (A,B)^{(1,n)} \textit{ has a global deadlock} $$
  
  \- with $c=2|B|-1$ and any $n>c$:
  $$(A,B)^{(1,c)} \textit{ has a deadlock} \ \Implied\ (A,B)^{(1,n)} \textit{ has a deadlock}$$
\il
\ak{seems not tight}
\end{restatable}
%\noindent Let us define the notion of ``process floods state and evacuates'' used in the proof.
%
%Given $P_1 \subseteq \{B_1,\ldots,B_n\}$, an infinite run $x=(s_1,e_1,p_1)\ldots$ of \largesys, let \emph{$ \visited_{\fin-P_1}(x)$ wrt. $P_1$}, and \emph{$ \visited_{\inf-P_1}(x) $ wrt. $P_1$} be:
%\begin{align}
%& \visited_{\inf-{P_1}}(x) = \{ q \|\! \exists \text{ infinitely many } ~~~~ m\!:  
%s_m(B_p)\!=\!q 
%\text{ for some } B_p\!\not\in\! P_1 \} \label{disj:def_vinf_wrt} \\
%& \visited_{\fin-{P_1}}(x) = \{ q \|\! \exists \text{ only finitely many } m\!:  
%s_m(B_p)\!=\!q 
%\text{ for some } B_p\!\not\in\!P_1 \} \label{disj:def_vfin_wrt}
%\end{align}
%
%Let $q \in \visited_{\fin-P_1}(x) $. Note that in run $x$ there is a moment $f_q$ when $q$ is reached first by some B-process denoted $B_{\first_q}$. And in run $x$ there is a moment $l_q$ when $q$ is left last by some B-process denoted $B_{\last_q}$. Let $B_i$ be a process of another system \cutoffsys. Let $y$ be a run of \cutoffsys that we plan to construct from the run $x$. Then, \emph{process $B_i$ of \cutoffsys floods $q$ and then evacuates into $\visited_{\inf-B_1}(x)$} means: 
%$$y(B_i) = x(B_{\first_q})\slice{1}{f_q} \ \cdot\ (q)^{(l_q - f_q + 1)} \cdot \ x(B_{\last_q})\slice{l_q}{m} \ \cdot \ (q')^\omega,$$
%where $q'$ is a state in $\visited_{\inf-P_1}(x)$ that $B_{\last_q}$ reaches first at some moment $m \geq l_q$. In words, process mimics process $B_{\first_q}$ until it reaches $q$, then does nothing until process $B_{\last_q}$ starts leaving, then mimics $B_{\last_q}$ until it reaches $ \visited_{\inf-P_1}(x) $.
\begin{proof}
\input{proof-disj-deadlock}
\end{proof}

\begin{restatable}[Disj, Deadlocks, Unfair]{tightness}{TightDisjDeadlockLemma}
\label{obs:disj:tight_deadlock}
The cutoff $c=2|B|-1$ for deadlock detection in disjunctive systems is \emph{asymptotically optimal but possibly not tight}, i.e.: for any $k$ there are templates $(A,B)$ with $|B|=k$ such that:
$$
(A,B)^{(1,|B|-1)} \textit{ does not have a deadlock, but } (A,B)^{(1,|B|)} \textit { does}.
$$
\end{restatable}

\input{tight-disj-deadlock}



\subsection{Disjunctive Systems with Fairness}

\begin{restatable}[Monotonicity: Disj, Props, Fair]{lem}{DisjBoundingLemmaFair}
\label{disj:le:FairDisjunctiveBounding}
For disjunctive systems:
\begin{align*}
& \forall n \geq 1: \\
&(A,B)^{(1, n)} \models \pexists_{uncond} h(A,B_1) 
\implies
(A,B)^{(1,n+1)} \models \pexists_{uncond} h(A,B_1),\\
\end{align*}
% 
\end{restatable}
\begin{proof}
In run $x$ of $(A,B)^{(1,n)}$ with $n \geq 1$ all processes move infinitely often. 
Hence let the run $y$ of $(A,B)^{(1,n+1)}$ copy $x$, 
and let the new process mimic an infinitely moving B process of $(A,B)^{(1,n)}$.
\end{proof}

\begin{restatable}[Bounding: Disj, Props, Fair]{lem}{DisjBoundingLemmaFair}
\label{disj:le:FairDisjunctiveBounding}
For disjunctive systems:
\begin{align*}
&\forall n>2|B|: \\
&(A,B)^{(1,2|B|)} \models \pexists_{uncond} h(A,B_1) &
&\impliedby& &
(A,B)^{(1,n)} \models \pexists_{uncond} h(A,B_1),\\
\end{align*}
% 
\end{restatable}
The proof was given in the main text, in Section~\ref{sec:ideas-disj-fair}.

%\myparagraph{Fair Extension}
%\input{fair_extension}
%\begin{proof}[Proof of Lemma \ref{disj:le:FairDisjunctiveBounding}]
%\input{proof-disj-bounding-fair}
%\end{proof}

\begin{restatable}[Disj, Props, Fair]{tightness}{TightDisjBoundingLemmaFair}
\label{obs:disj:fair_tight_prop}
The cutoff in Lemma~\ref{disj:le:FairDisjunctiveBounding} is tight, i.e., 
for any $k$ there exist process templates $(A,B)$ with $|B| = k$ 
and $\LTLmX$ formula $h(A,B_1)$ such that:
$$
(A,B)^{(1,2|B|)} \models \pexists h(A,B_1) ~~and~~ 
(A,B)^{(1,2|B|-1)} \not\models \pexists h(A,B_1).
$$
\ak{what happens if we bound $T_A$?}
\end{restatable}
The proof was described in the main text, in Section~\ref{sec:ideas-disj-fair}.
\begin{proof}
\input{tight-disj-bounding-fair}
\end{proof}

\ifwithextensions
\begin{restatable}[Generalized Bounding Lemma, Unconditionally Fair]{lem}{DisjBoundingLemmaFairGeneral}
\label{disj:le:FairDisjunctiveBounding:general}
For disjunctive systems:
\begin{align*}
&(A,B)^{(1,> 2\card{B}+n-1)} \models \pexists_{uncond} h(A,B^{(n)}) &
&~\iff~& &
(A,B)^{(1,2\card{B}+n-1)} \models \pexists_{uncond} h(A,B^{(n)}),\\
\end{align*}
% 
\end{restatable}
\iffinal
\input{proof-disj-bounding-fair-general}
\else
\fi

\begin{restatable}{obs}{TightDisjBoundingLemmaFairGeneral}
\label{obs:disj:fair_tight_prop:general}
The cutoff in Lemma~\ref{disj:le:FairDisjunctiveBounding:general} is tight.
\end{restatable}

\input{tight-disj-bounding-fair-general}
\fi % \ifwithextensions


\begin{restatable}[Monotonicity: Disj, Deadlocks, Fair]{lem}{mono_lem_disj_deadlocks_fair}
\label{mono_lem_disj_deadlocks_fair}
For disjunctive systems, on strong-fair or finite runs:
$$
\forall n\geq |B|+1: (A,B)^{(1,n)} \textit{ has a deadlock} 
\ \Impl\ 
(A,B)^{(1,n+1)} \textit{ has a deadlock}
$$
\end{restatable}
\begin{proof}
See proof of Lemma~\ref{mono_lem_disj_deadlocks_unfair}.
\end{proof}

\begin{restatable}[Bounding: Disj, Deadlocks, Fair]{lem}{DisjDeadlockLemmaFair}
\label{le:disj:fair_tight_deadlock}
For disjunctive systems, on strong-fair or finite runs:
\li
  \- with $c=2|B|-1$ and any $n>c$:
  $$(A,B)^{(1,c)} \textit{ has a local deadlock} \ \Implied\ (A,B)^{(1,n)} \textit{ has a local deadlock}$$
  
  \- with $c=2|B| - 1$ and any $n>c$
  $$(A,B)^{(1,c)} \textit{ has a global deadlock} \ \Implied\ (A,B)^{(1,n)} \textit{ has a global deadlock} $$
  
  \- with $c=2|B|-1$ and any $n>c$:
  $$(A,B)^{(1,c)} \textit{ has a deadlock} \ \Implied\ (A,B)^{(1,n)} \textit{ has a deadlock}$$
\il
\end{restatable}
\begin{proof}
\input{proof-disj-deadlock-fair}
\end{proof}

\begin{restatable}[Disj, Deadlocks, Fair]{tightness}{TightDisjDeadlockLemmaFair}
\label{obs:disj:fair_tight_deadlock}
The cutoff $c=2|B|-1$ for deadlock detection in disjunctive systems on strong-fair or finite runs is tight, i.e.: for any $k$ there are templates $(A,B)$ with $|B|=k$ such that:
$$
(A,B)^{(1,2|B|-2)} \textit{ does not have a deadlock, but } (A,B)^{(1,2|B|-1)} \textit { does}.
$$
\end{restatable}

\input{tight-disj-deadlock-fair}

\ifwithextensions   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Label-dependent Cutoffs for Disjunctive Systems}
\sj{To Do: compare to synchronization skeletons}

The results presented in Lemmas~\ref{disj:le:NonFairDisjunctiveBounding} and \ref{disj:le:FairDisjunctiveBounding} give cutoffs that depend only on the size of templates, without considering the number of output variables that can be used to distinguish states in transition guards. In the following, we analyze the effect of a limited number of output variables on cutoffs. Let $L_B$ be the set of state labels of process template $B$, and $\labelings_B = \bbB^{L_B}$ the set of labelings of $B$.

\begin{restatable}[Bounding Lemma, Label-dependent, Unfair]{lem}{DisjBoundingLemmaLabel}
\label{disj:le:NonFairDisjunctiveBoundingLabels}
For disjunctive systems:
\begin{align*}
&(A,B)^{(1,> \card{\labelings_B} + 2)} \models \pexists h(A,B_1) &
&~\iff~& &
(A,B)^{(1,\card{\labelings_B} + 2)} \models \pexists h(A,B_1).
\end{align*}
\end{restatable}
\iffinal
\else
\input{proof-disj-bounding-label}
\fi

\begin{restatable}[Deadlock Detection, Label-dependent, Unfair]{lem}{DisjDeadlockLemmaLabel}
\label{le:disj:deadlocks:label}
If the open disjunctive system $(A,B)^{(1,2\card{\labelings_B})}$ has no local deadlocks, then no disjunctive system $(A,B)^{(1,n)}$ with $n \geq 2\card{\labelings_B}$ has local deadlocks.
\end{restatable}
\iffinal
\else
\input{proof-disj-deadlock-label}
\fi

\begin{restatable}[Bounding Lemma, Unconditional Fairness, Label-dependent]{lem}{DisjBoundingLemmaLabelFair}
\label{disj:le:FairDisjunctiveBoundingLabels}
For unconditionally-fair runs of disjunctive systems:
\begin{align*}
&(A,B)^{(1,> 3 \card{\labelings_B} - 1)} \models \pexists h(A,B_1) &
&~\iff~& &
(A,B)^{(1,3 \card{\labelings_B} - 1)} \models \pexists h(A,B_1).
\end{align*}
\end{restatable}
\iffinal
\else
\input{proof-disj-bounding-label-fair}
\fi

\begin{restatable}[Deadlock Detection, Strong Fairness, Label-dependent]{lem}{DisjDeadlockLemmaLabelFair}
\sj{wait for clarification in fair state-based case}
\end{restatable}
\fi %ifwithextensions   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
