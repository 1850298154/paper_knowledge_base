%!TEX root = main.tex

\begin{proof}
	We show that there is a polynomial-time fixed parameter tractable reduction from
	INDEPENDENT-SET(c) to the problem of checking the existence of deadlock-patterns
	of size $c$.
	Our reduction takes as input an undirected graph $G$ and outputs a trace $\tr$
	such that $G$ has an independent set of size $c$ iff $\tr$
	has a deadlock pattern of size $c$.
	%Here present the construction and refer to \appref{proofs} for the proof of correctness.
	
	\begin{figure}[]
		\input{figures/construction-w1-hardness}
		\hfill ~~ %\unskip\ \vrule\ \hfill
		\input{figures/construction-ov-hardness}
		\caption{
		Construction of $\W{1}$-hardness (\subref{fig:w1-hardness}) and OV-hardness (\subref{fig:ov-hardness}) results. 
		We use the shortcut $\cs(\lk,\lk')$ to denote two nested critical sections on $\lk$ and $\lk'$. That is,
	$\cs(\lk,\lk')=\acq(\lk) \cdot\acq(\lk') \cdot\rel(\lk') \cdot \rel(\lk)$.
		} 
		%\label{fig:main}
	\end{figure}


	\myparagraph{Construction}{
		%Let $G = (V, E)$ be the input graph and let $c$ be the parameter.
		Let $V = \set{v_1, v_2, \ldots, v_n}$.
		We assume a total ordering $<_E$ on the set of edges $E$.
		The trace $\tr$ we construct is a concatenation of $c$ sub-traces: 
		$
		\tr = \tr^{(1)} \cdot \tr^{(2)} \cdots \tr^{(c)}
		$
		and uses $c$ threads $\set{t_1, t_2, \ldots t_c}$ and
		$|E| + c$ locks $\set{\lk_{\set{u, v}}}_{\set{u, v} \in E} \uplus \set{\lk_0, \lk_1 \ldots, \lk_{c-1}}$.
		The $i^\text{th}$ sub-trace $\tr^{(i)}$ is a sequence of events performed by thread $t_i$, and
		is obtained by concatenation of $n = |V|$ sub-traces:
		$
		\tr^{(i)} = \tr^{(i)}_1 \cdot \tr^{(i)}_2 \cdots \tr^{(i)}_n
		$.
		Each sub-trace $\tr^{(i)}_j$ with $(i \leq c, j \leq n)$ 
		comprises of nested critical sections over locks of the 
		form $\lk_{\set{v_j, u}}$, where $u$ is a neighbor of $v_j$.
		Inside the nested block we have critical 
		sections on locks $\lk_{i \% c}$ and $\lk_{(i+1) \% c}$.
		Formally, let $\set{v_j, v_{k_1}}, \ldots, \set{v_j, v_{k_d}}$
		be the neighboring edges of $v_j$ (ordered according to $<_E$).
		Then, $\tr^{(i)}_j$ is the unique string generated by the
		grammar having $d+1$ non-terminals $S_0, S_1, \ldots, S_d$, start symbol $S_d$
		and the following production rules:
		\begin{itemize}
			\item $S_0 \to \ev{t_i, \acq(\lk_{i \% c})} \cdot \ev{t_i, \acq(\lk_{(i+1) \% c})} \cdot \ev{t_i, \rel(\lk_{(i+1) \% c})} \cdot \ev{t_i, \rel(\lk_{i \% c})}$.
			\item for each $1 \leq r \leq d$, $S_r \to \ev{t_i, \acq(\lk_{\set{v_j, v_{k_r}}})} \cdot S_{r-1} \cdot \ev{t_i, \rel(\lk_{\set{v_j, v_{k_r}}})}$.
		\end{itemize}
		\figref{w1-hardness} illustrates this construction for a graph with $3$ nodes
		and parameter $c = 3$.
		Finally, observe that the lock-nesting depth in $\tr$ is bounded by 2 + the degree of $G$.
	}
\end{proof}





