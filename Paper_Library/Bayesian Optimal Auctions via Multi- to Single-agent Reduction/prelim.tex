%\input{../template}

%\newcommand{\E}{\mathbf{E}}

%\newcommand{\Dist}{\mathcal{D}}
%\newcommand{\Inter}[1]{\widetilde{#1}}
%\newcommand{\Poly}[1]{poly(#1)}
%\newcommand{\CC}[1]{\widehat{#1}}
%\newcommand{\Src}{\overline{src}}
%\newcommand{\Snk}{\overline{snk}}
%\newcommand{\Ol}[1]{\overline{#1}}
%\newcommand{\Ul}[1]{\underline{#1}}



\section{Preliminaries}
\label{sec:prelim}

\paragraph{Single-agent Mechanisms}
%%
%% services
%%

%A service provider faces $n$ agents and may offer service to any
%subset of size at most $k$ of them.

We consider the provisioning of an abstract service.  This service may
be parameterized by an {\em attribute}, e.g., quality of service, and
may be accompanied by a required payment.  We denote the outcome
obtained by an agent as $\outcome \in \outcomespace$.  We view this
outcome as giving an indicator for whether or not an agent is served and
as describing attributes of the service such as quality of service and
monetary payments.  Let $\ALLOC(\outcome) \in \{0,1\}$ be an indicator
for whether the agent is served or not; let $\PAYMENT(\outcome)
\in \reals$ denote any payment the agent is required to make.  In a
randomized environment (e.g., randomness from a randomized mechanism or Bayesian
environment) the outcome an agent receives is a random variable from a
distribution over $\outcomespace$.  The space of all such
distributions is denoted $\outcomedistspace$.

%%
%% types, utilities, prior
%%
The agent has a type $\type$ from a finite type space $\typespace$.
This type is drawn from distribution $\dens \in \distover{\typespace}$
and we equivalently denote by $\dens$ the probability mass function.
I.e., for every $\type \in \typespace$, $\dens(\type)$ is the
probability that the type is~$\type$.  The utility function $\util
\,:\, \typespace \times \outcomespace \to \reals$ maps the agent's
type and the outcome to real valued utility.  The agent is a von
Neumann--Morgenstern expected utility maximizer and we extend $\util$
to $\distoutcomespace$ linearly, i.e., for $\outcome
\in \distoutcomespace$, $\util(\type, \outcome)$ is the expectation of $\util$ where the outcome is drawn according
to~$\outcome$.
%$\util(\type,\outcome) = \expect[v \sim \outcome]{\util(\type,v)}$.
We do not require the usual assumption of quasi-linearity.



%%
%% incentives, service rule
%%
%By the revelation principle, we will restrict attention to Bayesian
%incentive compatible mechanisms, i.e., ones in which truthtelling is a
%Bayes-Nash equilibrium.  For an implicit mechanism we will denote the
%{\em outcome rule} by $\outcomes(\types)$ where
%$\outcome\agind(\types)$ is the service to agent $\agent$.  Similarly
%we will denote by $\allocs(\types)$ and $\prices(\types)$ the {\em
%  allocation} and {\em payment rule}.  These may be random variables
%and we denote their expectations by $\expallocs(\types) =
%\expect{\allocs(\type)}$ and $\expprices(\types) =
%\expect{\prices(\types)}$.
%When the agents' types are drawn from the
%product distribution $\dists = (\dist\agind[1] \times \cdots \times
%\dist\agind[n])$, agent $\agent$'s {\em interim outcome rule} is
%$\outcome\agind(\type\agind) =
%\evalat{\outcome\agind(\types)}{\type\agind}$ for $\types \sim \dists$ denoting the
%distribution over the service that agent $\agent$ receives when other
%types are drawn from the distribution.

%%
%% outcome rule
%%
A single-agent mechanism, without loss of generality by the revelation
principle, is just an {\em outcome rule}, a mapping from
the agent's type to a distribution over outcomes.  We denote an {\em
  outcome rule} by $\toutcome \,:\, \typespace
\to \outcomedistspace$.  We say that an outcome rule $\toutcome$ is
{\em incentive compatible} (IC) and {\em individually rational} (IR) if for
all $\type,\type' \in \typespace$, respectively,
\begin{align}
\tag{IC}\label{eq:IC}
\util(\type,\toutcome(\type)) &\geq \util(\type,\toutcome(\type')),\\
\tag{IR}\label{eq:IR}
\util(\type,\toutcome(\type)) &\geq 0.
\end{align}


%%
%% allocation rule
%%
%As the mechanism designer faces a constraint only on the allocation
%portion of the service it will be useful to separate out that part.
We refer to restriction of the outcome rule to the indicator for
service as the {\em allocation rule}.  As the allocation to
each agent is a binary random variable, distributions over allocations
are fully described by their expected value.  Therefore the allocation
rule $\talloc \,:\, \typespace \to [0,1]$ for a given outcome rule
$\outcome$ is $\talloc(\type) = \expect{\ALLOC(\toutcome(\type))}$.


%%
%% Tiger: added the following Examples
%%
We give two examples to illustrate the abstract model described above.
The first example is the standard quasi-linear risk-neutral preference
which is prevalent in auction theory.  Here the agent's type space is
$\typespace \subset \posreals$ where $\type \in \typespace$ represents the
agent's valuation for the item.  The outcome space is $\outcomespace =
\{0, 1\} \times \posreals$ where an outcome $\outcome$ in this space
indicates whether or not the item is sold to the agent, by
$\ALLOC(\outcome)$, and at what price, by $\PAYMENT(\outcome)$.  The
agent's quasi-linear utility function is $\util(\type, \outcome) =
\type \cdot \ALLOC(\outcome) - \PAYMENT(\outcome)$.
%
% example 2
%
The second example is that of an $\numservice$-item unit-demand (also
quasi-linear and risk-neutral) preference.  Here the type space is
$\typespace \subset \posreals^\numservice$ and a type $\type
\in \typespace$ indicates the agent's valuation for each of the items
when the agent's value for no service is normalized to zero.  An
outcome space is $\outcomespace = \{0,\ldots,\numservice\} \times
\posreals$.  The first coordinate of $\outcome$ specifies which item
the agent receives or none and $\ALLOC(\outcome) = 1$ if it is
non-zero; the second coordinate of $\outcome$ specifies the required
payment $\PAYMENT(\outcome)$.  The agent's utility for $\outcome$ is
the value the agent attains for the item received less her payment.
Beyond these two examples, our framework can easily incorporate more
general agent preferences exhibiting, e.g., risk aversion or a budget
limit.


\Xcomment{
%%
%% Tiger: added the following Examples
%%
We give two examples to illustrate the set of notations above.  The
first example is the standard quasi-linear risk-neutral preference
which is prevalent in auction theory.  Here the type of the agent is
simply her valuation for the item, an outcome $\outcome$ is a tuple
$(\sdalloc, \sdprice) \in \{0, 1\} \times \posreals$ that indicates
(by $\sdalloc$) whether or not the item is sold to the agent and (by
$\sdprice$) at what price.  $\ALLOC(\sdalloc,\sdprice) = \sdalloc$ and
$\PAYMENT(\sdalloc,\sdprice)$ is $\sdprice$.  The agent's quasi-linear
utility function is $\util(\type, (\sdalloc,\sdprice)) = \type
\sdalloc - \sdprice$.
%
% example 2
%
The second example is that of a $\numservice$-item unit-demand (also
quasi-linear and risk-neutral) preference.  Here the type $\type :
\{0,\ldots, \numservice\} \to \posreals$ indicates the agent's
valuation for each of the items or $\mdtype{0} = 0$ for no service.
An outcome $\outcome = (\mdalloc, \mdprice) \in
\{0,\ldots,\numservice\} \times \posreals$.  Here, $\mdalloc$
specifies which item the agent receives or none if $\mdalloc = 0$,
therefore, $\ALLOC(\mdalloc,\mdprice) = 1$ if $\mdalloc > 0$ and zero
otherwise, $\PAYMENT(\mdalloc,\mdprice) = \mdprice$.  The agent's
utility is $\util(\type,(\mdalloc,\mdprice)) = \mdtype{\mdalloc} -
\mdprice$.  Of course, our framework can easily incorporate more
general settings such as those involving a risk averse agent with a
budget limit.
}


%%
%% quantile
%%
% An allocation rule $\talloc$ induces a partial ordering on the type
% space.  Given two types $\type$ and $\type'$ we can order them by
% which is more likely to be allocated and refer to the one that is more
% likely to be allocated as the stronger one.  Furthermore, given the
% distribution $\dist$ over type space, we can associate with each type
% a quantile which refers to the strength of a type relative to the
% distribution.  The quantile $\quant \in [0,1]$ of a type is the
% probability that a random type from the distribution is stronger.  Let
% $\quantl$ be the probability that a random type is strictly stronger
% and let $\quante$ be the probability that a type is equally strong,
% i.e., $\quantl = \prob[\type'\sim\dist]{\talloc(\type') >
%   \talloc(\type)}$ and $\quante = \prob[\type'\sim\dist]{\talloc(\type')
%   = \talloc(\type)}$.  The quantile for a type $\type$ and type
% allocation rule $\alloc$, denoted $\QUANT(\type,\talloc)$, is a random
% draw from the distribution $\quantl + U[0,\quante]$.  Importantly,
% the distribution over quantiles of a random type $\type \sim \dist$ is
% $U[0,1]$.  (The randomization of $\quante$ mass is simply a random
% tie-breaking rule; we encourage the reader to assume no ties, i.e.,
% that $\quante = 0$, and that $\QUANT(\type,\talloc)$ is deterministic.)
%

%%
%% single-agent quantile-allocation-constrained mechanism design
%%
% The transformation from type to quantile and a type allocation rule
% induces a {\em (quantile) allocation rule} $\qalloc \,:\, [0,1] \to
% [0,1]$ that maps quantiles to allocation probabilities; for a given
% type-allocation rule $\alloc$ and the mapping of type to quantile that
% it induces, the quantile allocation rule $\qalloc$ is defined as
% $\qalloc(\QUANT(\type,\talloc)) = \talloc(\type)$.  Notice that there
% may be multiple type allocation rules with the same quantile
% allocation rule.  A single-agent mechanism design problem is the
% following: {\em Given a desired quantile allocation rule, design the
%   optimal type outcome rule that induces this quantile allocation
%   rule.}
%
%%
%% single-agent downward-closed quantile-allocation-constrained mechanism design
%%
% A more permissive requirement which is consistent with a standard
% downward-closure assumption is to require the outcome rule to induce a
% quantile allocation rule that dominated by the desired quantile
% allocation rule.  The {\em cumulative allocation rule} is the integral
% of the quantile allocation rule, i.e., $\cumalloc(\quant) =
% \int_0^\quant \qalloc(\dquant)\, d \dquant$ for quantile allocation
% rule $\qalloc$.  A cumulative allocation rule $\cumalloc$ {\em
%   dominates} $\cumalloc'$ if for all $\quant$, $\cumalloc(\quant) \geq
% \cumalloc'(\quant)$.  An outome or allocation rule dominates another
% outcome or allocation rule of their induced cumulative allocation
% rules satisfy the dominance condition.  Our single-agent mechanism
% design problem is the following: {\em Given a desired quantile
%   allocation rule, design the optimal type outcome rule that is
%   dominated by the desired quantile allocation rule.}
%
%%
%% single-agent ex ante constrained mechanism design
%%
% A special case of quantile allocation rule is the one that places an
% ex ante constraint on the probability that the agent is allocated.
% For a given constraint $\aquant$ this allocation rule is a step
% function, denoted $\aqalloc[\aquant]$, which steps from 0 to 1 at $\quant =
% \aquant$.  Such a rule says to allocate to the agent with ex ante
% probability $\aquant$.
%

%%
%% single-agent optimal mechanisms
%%
% Given a quantile allocation rule $\qalloc$ for a type space
% $\typespace$ and a distribution over types $\dist$, a ``solution'' to
% the single-agent problem constructs an optimal type outcome rule
% $\RULE(\qalloc)$ with expected performance which we denote
% $\REV(\qalloc)$.  For the special case above of an ex ante allocation
% probability constraint $\aquant$, i.e., the quantile allocation rule
% $\aqalloc[\aquant]$, we overload notation and write $\REV(\aquant)$
% and $\RULE(\aquant)$ for $\REV(\aqalloc[\aquant])$ and
% $\RULE({\aqalloc[\aquant]})$, respectively.
%

%%
%% single-agent problem
%%

Consider the following single-agent mechanism design problem.  A
feasibility constraint is given by an upper bound $\talloc(\type)$ on
the probability that the agent is served as a function of her type
$\type$; the distribution on types in $\typespace$ is given by
$\dens$.  The single-agent problem is to find the outcome rule
$\toutcome^*$ that satisfies the allocation constraint of $\talloc$
and maximizes the performance, e.g., revenue.  This problem is
described by the following program:
\begin{align*}
\max_{\toutcome}:  & \quad \expect[\type \sim \dens, \toutcome(\type)]{\PAYMENT(\toutcome(\type))}
\tag{SP}\label{eq:rule-rev-def} \\
\hbox{s.t. } & \quad \expect[\toutcome(\type)]{\ALLOC(\toutcome(\type))} \leq \talloc(\type), \qquad \forall \type \in \typespace \\
 & \quad \toutcome \text{ is IC and IR}.
\end{align*}
We denote the outcome rule $\toutcome^*$ that optimizes this program
by $\RULE(\talloc)$ and its revenue by $\REV(\talloc) = \expect[\type
  \sim \dens, \toutcome^*(\type)]{\PAYMENT(\toutcome^*(\type))}$.  We note
that, although this paper focuses on revenue maximization, the same
techniques presented can be applied to maximize (or minimize) general
separable objectives such as social welfare.

\paragraph{Multi-agent Mechanisms}


%%
%% feasibility
%%
There are $n$ independent agents.  Agents need not be identical,
i.e., agent $\agent$'s type space is~$\typespace\agind$, the
probability mass function for her type is~$\dens\agind$,
her outcome space is $\outcomespace\agind$, and her utility function
is $\util\agind$. The profile of agent types is denoted by $\types =
(\type\agind[1],\ldots,\type\agind[n]) \in \typespace\agind[1] \times
\cdots \times \typespace\agind[n] = \typespaces$, the joint
distribution on types is $\denss \in \distover{\typespace_1}\times \cdots \times \distover{\typespace_n}$, a vector of outcomes is
%% Tiger:  removed "\outcomes =" and "\allocs = ".  we never use them in the paper for deterministic outcomes, and the
%%     current notation coincides with the randomized outcomes, which may cause confusion.  Also, replaced all
%%     semi-colons by commas in this sentence
%$\outcomes =
$(\outcome\agind[1], \cdots, \outcome\agind[n]) \in \outcomespaces$, and an allocation is
%$\allocs =
$(\alloc\agind[1],\ldots,\alloc\agind[n]) \in \{0,1\}^n$.  The
mechanism has an inter-agent feasibility constraint that permits
serving at most $k$~agents, i.e., $\sum_\agent \alloc\agind \leq
k$.\footnote{Furthremore, in Section~\ref{sec:border_matroid}, we
  review the theory of {\em matroids} and extend our basic results
  environments with feasibility constraint derived from a matroid set
  system.}  A mechanism that obeys this constraint is {\em
  feasible}. The mechanism has no inter-agent constraint on attributes
or payments.


%%
%% induced allocation rules
%%
A mechanism maps type profiles to a (distribution over) outcome
vectors via an {\em ex post outcome rule}, denoted $\epoutcomes \,:\,
\typespaces \to \outcomedistspaces$ where $\epoutcome\agind(\types)$
is the outcome obtained by agent $\agent$. We will similarly define
$\epallocs \,:\, \typespaces \to [0,1]^n$ as the {\em ex post
  allocation rule} (where $[0,1] \equiv \distover{\{0,1\}}$).  The ex
post allocation rule~$\epallocs$ and the probability mass
function~$\denss$ on types induce {\em interim} outcome and allocation
rules.  For agent~$\agent$ with type~$\type\agind$ and $\types \sim
\distribution[\types]{\types \given \type\agind}$ the interim outcome
and allocation rules are $\intoutcome\agind(\type\agind) =
\distribution[\types]{\epoutcome\agind(\types) \given \type\agind }$
and $\intalloc\agind(\type\agind) =
\distribution[\types]{\epalloc\agind(\types) \given \type\agind}
\equiv \expect[\types]{\epalloc\agind(\types) \given
  \type\agind}$.\footnote{We use notation $\distribution{X \given E}$
  to denote the distribution of random variable $X$ conditioned on the
  event $E$.}  A profile of interim allocation rules is feasible if it
is derived from an ex post allocation rule as described above; the set
of all feasible interim allocation rules is denoted by $\InAllocSpace$.
A mechanism is Bayesian incentive compatible and interim individually
rational if equations~\eqref{eq:IC} and~\eqref{eq:IR}, respectively,
hold for all $\agent$ and all~$\type\agind$.



%%
%% examples revisited
%%
Consider again the examples described previously of quasi-linear
single-dimensional and unit-demand preferences.  For the
single-dimensional example, the multi-agent mechanism design problem
is the standard single-item $k$-unit auction problem.  For the
unit-demand example, the multi-agent mechanism design problem is an
{\em attribute auction}.  In this problem there are $k$-units
available and each unit can be configured in one of $\numservice$
ways.  Importantly, the designer's feasibility constraint restricts
the number of units sold to be $k$ but places no restrictions on how
the units can be configured.  E.g., a restaurant has $k$ tables but
each diner can order any of the $m$ entrees on the menu.

% The interim type allocation rule of an agent, as described above, induces a mapping from type space to quantile space, and this mapping induces an interim quantile allocation rule.  We call the resulting profile $\qallocs = (\qalloc\agind[1],\ldots,\qalloc\agind[n])$ of quantile allocation rules {\em feasible} as there exists a ex post feasible outcome rule that, for the given distribution, induces them.

%% Tiger:  added \agind for all variables (since it makes more sense for talking about interim allocations).  added a pointer to Section single-agent
A reduction from multi-agent mechanism design to single-agent
mechanism design as we have described above would assume that for any
types pace $\typespace\agind$, any probability mass
function~$\dens\agind$, and interim allocation rule $\intalloc\agind$,
the optimal outcome rule $\RULE(\intalloc\agind)$ and its performance
$\REV(\intalloc\agind)$ can be found efficiently (see
Section~\ref{sec:single-agent} for examples).  The goal then is to
construct an optimal multi-agent auction from these single-agent
mechanisms.  Our approach to such a reduction is
%% Tiger:  replaced "the following" by "as follows".
%the following.
as follows.
\begin{enumerate}
\item \label{step:optimize}
Optimize, over all feasible profiles of interim allocation rules
$\intallocs = (\intalloc\agind[1],\ldots,\intalloc\agind[n]) \in \InAllocSpace$, the
%% Tiger:  replaced "total performance of the optimal outcome rules" by "sum of performances of the allocation rules"
%total performance of the optimal outcome
sum of performances of the allocation
rules $\sum_\agent \REV(\intalloc\agind)$.
\item \label{step:expostize} Implement the profile of interim outcome
  rules $\intoutcomes$ given by $\intoutcome\agind =
  \RULE(\intalloc\agind)$ with a feasible ex post outcome rule $\epoutcomes$.
\end{enumerate}

Two issues should be noted.  First, Step~\ref{step:expostize} requires
an argument that the existence of a feasible ex post outcome rule for
a given profile of interim allocation rules implies the existence of
one that combines the optimal interim outcome rules
from~$\RULE(\cdot)$.  We address this issue in Section~\ref{sec:alg}.
Second, Step~\ref{step:optimize} requires that we optimize over
jointly feasible interim allocation rules, and after solving for
$\intallocs$, its implementation by an ex post allocation rule is
needed to guide Step~\ref{step:expostize}.  We address this issue in
Section~\ref{sec:ssa}.  For single-unit (i.e., $k=1$) auctions a
characterization of the necessary and sufficient condition for interim
feasibility was provided by Kim Border.

%% Jason: i am not sure why the discussion below is in the
%% preliminaries section.

%% When $k$, the
%% number of agents we are allowed to serve, is~$1$, we give a general
%% structural theorem in Section~\ref{sec:int2expost} showing, by an
%% efficient algorithm, that every set of feasible interim allocation
%% rules can be implemented by a \emph{stochastic sequential allocation}
%% procedure. %azarakhsh changed the name
%% This allows us to describe all
%% feasibility constraints on interim allocation rules by polynomially
%% many linear inequalities, with some additional variables.  In
%% geometric terms, we identify the (generally exponentially-faceted)
%% polytope of all jointly feasible interim allocation rules as a
%% projection of a higher-dimensional polytope that has only polynomially
%% many facets. This gives, as a corollary, a generalization of Border's
%% inequality, which was known only for single-item auctions before this
%% work:

% For instance, single-item auction environments, i.e., $k=1$ and $\outcomespace = \{0,1\} \times \reals$,\footnote{In a single-item auction the outcome for an agent is the allocation and payment.} \citet{MR84} and \citet{M84} independently provided a condition necessary condition for feasibility.  The following theorem, due to \citet{B91} states that in these environments the same condition is also sufficient.

%\begin{reltheorem}[\citealp{B91}]
\begin{theorem}[\citealp{B91}]
\label{thm:border}%
In a single-item auction environment, interim allocation rules
$\intallocs$ are feasible (i.e., $\intallocs \in \InAllocSpace$) if
and only if the following holds:
\begin{align}
%% Tiger:  removed \type\agind\in
%\type\agind \in
\forall S\agind[1] \subseteq \typespace\agind[1],
\cdots, \forall S\agind[n] \subseteq \typespace\agind[n]: &\qquad
\sum_{\agent=1}^n \expect{\intalloc\agind(t_i) \given \type\agind \in
    S\agind}\cdot \prob{\type\agind \in S\agind}
        \le \prob[\types \sim \denss]{\exists i \in[n]: \type\agind \in S\agind
    } \tag{MRMB} \label{eq:MRM}
\end{align}
%\end{reltheorem}
\end{theorem}


%% \begin{example}[single-item, common budget]
%% Supply is $k = 1$, budget is $B \in \posreals$, type space is
%% $\typespace = \posreals$, service space is $\outcomespace =
%% \{0,1\}\times \emptyset \times \posreals$, and agent utility
%% $\util(\type,(\alloc,\emptyset,\price)$ is $\type \alloc - \price$ if $\price
%% \leq B$ and $-\infty$, otherwise.  The designer's objective is welfare
%% \citep{M00} or revenue \citep{LR96}.
%% \end{example}

%% \begin{example}[single-item, concave utility] Supply is $k = 1$, concave
%% utility function is $U : \posreals \to \posreals$, type space is
%% $\typespace = \posreals$, service space is $\outcomespace =
%% \{0,1\}\times \emptyset \times \posreals$, and agent utility
%% $\util(\type,(\alloc,\emptyset,\price)) = U(\type \alloc - \price)$.  The
%% designer's objective is revenue \citep{M84,MR84}.
%% \end{example}

%% \begin{example}[multi-unit, attribute auctions]
%% Supply is $k$, number of attributes is $m$, service space is
%% $\outcomespace = \{0,1\} \times \{1,\ldots,m\} \times \posreals$, type
%% space is $\typespace = \posreals^m$, and agent utility is quasi-linear
%% $\util(\type,(\alloc,\attrib,\price)) = \alloc (\type \cdot \attrib) -
%% \price$ (where $\type \cdot \attrib$ is the vector inner product). The
%% designer's objective is revenue.
%% \end{example}



\Xcomment{
\paragraph{Old Preliminary Section}



Consider a simple auction with $n$ participating agents for getting
%%  Tiger Nov 25: rephrased
%some type
one of $m$~services. In this
paper, we assume that we can serve at most $k$ of these agents. Each
agent $i \in [n]$ has a private type that defines his
%%  Tiger Nov 25: changed to plural forms to emphasize multi-dimensionality
values for the services.  The type of agent $i$ is denoted by $t_i \in T_i$,
%%  Tiger Nov 25: added the following explanation for valuation
and we use $v_i(t_i) = (v_i(t_i))_{j=1}^m \in \mathbb R^m$ to represent the vector of bidder~$i$'s valuations for the
$m$ services when his type is~$t_i$.
$T_i$ is
called the types pace of agent $i$.  Suppose that the agents' types
are drawn from independent but not
%%  Tiger Nov 25: added "necessarily"
necessarily identical distributions,
%%  Tiger Nov 25: added the following
publicly known as $\Dist = \Dist_1 \times \Dist_2 \times \cdots \times \Dist_n$.
$f_i(t_i)$ denotes the probability that agent $i$ has type $t_i$.
Furthermore, for every $S_i \subset T_i$, we define $f_i(S_i) =
\sum_{t_i \in S_i} f_i(t_i)$.
%%  Tiger Nov 25: deleted the following sentence on BNE
%A Bayes-Nash equilibrium (BNE) is a profile of strategies for mapping
%%  Tiger Nov 25: changed "values" to "types"
%values
%types to bid to obtain best response assuming all other agents are using the best response strategy and their values are coming from %%  Tiger Nov 25: added "the known"
%the known distribution.
A mechanism solicits bids from the agents and determines the outcome which consists
of an allocation $x = (x_1(t_1),\ldots, x_n(t_n))$ and payments
$p = (p_1(t_1), p_2(t_2), \ldots, p_n(t_n))$,
%%  Tiger Nov 25: added the following explanation
where $x_i(t_i) = (x_i(t_i))_{j=1}^m \in \mathbb [0, 1]^m$ represents the probabilities with which bidder~$i$ receives service~$j$.
%%  Tiger Nov 25: deleted the following sentence
%When agents are bidding in the mechanism, they know their own type and other agents' distributions.


%%  Tiger Nov 25: deleted the following sentences
%Interim allocation is the expected allocation assigned to an agent with a given type where the expectation is over all other agents' types.
%Suppose the profile of types $t=(t_1,\cdots, t_n)$ is distributed according to a publicly known distribution $\Dist$.
Given any allocation rule $x$
%%  Tiger Nov 25: added "and payment rule p"
and payment rule $p$, we can define a corresponding
\emph{interim allocation rule}
%%  Tiger Nov 25: changed [0,1] to [0, 1]^m; otherwise I don't see how v_i(t_i) \cdot x_i(t_i) is defined.
$\Inter{x}_i : T_i \to [0, 1]^m$
%%  Tiger Nov 25: added interim payment rule
\emph{interim allocation rule} $\Inter{p}_i: T_i \to \mathbb R_+$
for each agent $i$ that specifies the expected
%%  Tiger Nov 25: replaced the phrase
%probability of winning
allocation and payment
for each type of agent $i$, i.e., $\Inter{x}_i(t_i) = \E_{t_{-i}
\sim \Dist_{-i}}[x_i(t_i, t_{-i})]$,
%%  Tiger Nov 25: added definition of interim payment
and $\Inter{p}_i(t_i) = \E_{t_{-i} \sim \Dist_{-i}} [p_i(t_i, t_{-i})]$.
The allocation $x$ that is
assigned to a profile of types by the mechanism is also called
ex-post allocation.
%%  Tiger Nov 25: rewrote the definition of Bayesian truthfulness
% To design BNE mechanisms, the mechanism should satisfy the following constraint:
If for each agent~$i$ and all types $t_i, t_j \in T_i$, a mechanism satisfies
\[
v_i(t_i)\cdot \Inter{x}_i(t_i) - \Inter{p}_i(t_i) \ge v_i(t_i)\cdot
\Inter{x}_i(t_j) - \Inter{p}_i(t_j)
\]
then the mechanism is said to be \emph{Bayesian truthful}.
%%  Tiger Nov 25: changed BNE to Bayesian truthful
Note that the constraint for Bayesian truthfulness is in terms only of interim allocation
and payments.
%%  Tiger Nov 25: rewrote the following before the enumeration
%As a result, to design a BNE mechanism we can formulate by one constraint per type of an agent.  However, we should be able to map the interim allocation to feasible ex post allocations to maintain the interim allocation probability for all agents and also to satisfy the feasibility constraint for the available service(items).
%To be able to build our mechanism based on computed interim allocations, we need to find the answer to the following questions:
As a result, when designing a Bayesian truthful mechanism, one may check all incentive constraints by inspecting only
the interim allocation and payment rules for each bidder, instead of going through the exponentially large description
of ex-post rules.  However, not every interim allocation rule $(\Inter{x}_1, \Inter{x}_2, \ldots, \Inter{x}_n)$ can be implemented by a feasible ex-post allocation; even if it
can, it is still challenging to find the right ex-post allocation implementing it.  In this paper, we give efficient algorithmic
solutions to the following two problems, which enable us to design optimal mechanisms in terms of reduced forms
described by interim allocations, for domains which would otherwise seem intractable:

\begin{enumerate}
\item
Are $\Inter{x}_1, \cdots, \Inter{x}_n$ feasible?  In other words, is
there a corresponding feasible ex-post allocation rule~$x$ such that
%%  Tiger Nov 25: rid "the following holds?" and added "for all i, for all t_i$
%the following holds?
$\forall i \in [n], \forall t_i \in T_i$, $\Inter{x}_i(t_i) = \E_{t_{-i} \sim \Dist_{-i}}[x_i(t_i, t_{-i})]$?

\item
%%  Tiger Nov 25: added the following, and shorten the question
If the answer to~\label{prob:A} is affirmative,
how can such an $x$ be computed?
\end{enumerate}

%%  Tiger Nov 25: refined the description
%For the case of $k=1$,
For the domain where one service ($m=1$) is to be provided to at most one agent $(k=1)$,
Maskin and Riley~\cite{MR84} and
Matthews~\cite{M84} independently
%%  Tiger Nov 25: rewrote the sentence.  "came up with" sounds too informal
provided a condition for the first problem, which they proved to be necessary.
%came up with necessary conditions for \eqref{prob:A}.
The next theorem
%which is
due to Border~\cite{B91} states that the same condition is in fact both
necessary and sufficient for that domain.
%$k=1$.


\begin{theorem}[\citealp{B91}]
\label{thm:border}%
In an $n$-agent
%% Tiger:  replaced "single-item" by "single-service"
%single-item
single-service
auction environment, interim allocation
rules $(\Inter{x}_1, \cdots, \Inter{x}_n)$
%%  Tiger Nov 25: restructured the sentence
%, there exists a feasible ex-post allocation rule $x$ that implements the interim allocation rules
can be implemented by a feasible ex-post allocation rule~$\epallocs$
if and only if the following holds:
\begin{align}
    \forall S_1 \subseteq T_1, \cdots, \forall S_n \subseteq T_n: &\qquad \sum_{i=1}^n \sum_{t_i\in S_i} \Inter{x}_i(t_i) f_i(t_i)
        \le \Pr_{t \sim \denss}\left[\exists i \in[n]: t_i \in S_i
    \right] \tag{MRM} \label{eq:MRM}
\end{align}
\end{theorem}
}
