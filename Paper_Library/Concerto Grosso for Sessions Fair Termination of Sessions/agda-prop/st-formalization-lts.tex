\beginbass
%
Let us move onto the definition of transitions for session types. 
We begin by defining an \lstinline{Action} data type to represent 
input/output actions, which consist of a polarity and a value.
The \emph{complementary action} of $\action$, denoted by $\co\action$ 
in the previous sections, is computed by the function \lstinline{co-action}.

\begin{lstlisting}
data Action : Set where
  I O : $\Message$ $\rightarrow$ Action

co-action : Action $\rightarrow$ Action
co-action (I x) = O x
co-action (O x) = I x 
\end{lstlisting}

A \emph{transition} is a ternary relation among two session types and an action. 
A value of type \lstinline{Transition S $\action$ T} represents the transition $S \lred\action T$. 
Note that the premise \lstinline{x $\in$ dom f} in the constructor 
\lstinline{out} corresponds to the side condition 
$S \ne \TNil$ of rule \refrule{output}.

\begin{lstlisting}
data Transition : SessionType $\rightarrow$ Action $\rightarrow$ SessionType $\rightarrow$ Set 
  where
    inp : $\forall${f x} $\rightarrow$ Transition (inp f) (I x) (f x .force)
    out : $\forall${f x} $\rightarrow$ 
    	x $\in$ dom f $\rightarrow$ Transition (out f) (O x) (f x .force)
\end{lstlisting}

A session \emph{reduces} when client and server synchronize, by performing 
actions with opposite polarities and referring to the same message.
We formalize the reduction relation in \Cref{fig:agda_st_lts} as the \lstinline{Reduction} 
data type, so that a value of type \lstinline{Reduction ($\session{R}{S}$) ($\session{R'}{S'}$)}
witnesses the reduction $\session{R}{S} \red \session{R'}{S'}$.
At last, the weak reduction relation is called \lstinline{Reductions}
and is defined as the reflexive, transitive closure of \lstinline{Reduction}, 
just like $\wred$ is the reflexive, transitive closure of $\red$. 
We make use of the \lstinline{Star} data type from Agda's standard library to define such closure.

\begin{lstlisting}
data Reduction : Session $\rightarrow$ Session $\rightarrow$ Set where
  sync : $\forall${$\action$ R R' S S'} $\rightarrow$ Transition R (co-action $\action$) R' $\rightarrow$ 
  	Transition S $\action$ S' $\rightarrow$ Reduction (R , S) (R' , S')
  	
Reductions : Session $\rightarrow$ Session $\rightarrow$ Set
Reductions = Star Reduction
\end{lstlisting}

