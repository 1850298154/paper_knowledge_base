\beginalto
%
In this section we detail the mechanized correctness proof of \emph{fair compliance}
(see point 2. of \Cref{thm:compliance}).
As usual, correctness is expressed in terms of \emph{soundness} and \emph{completeness}
of \lstinline{_$\compliance{}{}$_} with respect to some specification.
Such specification is defined in \Cref{def:fcomp}. 
Before looking at such proofs, we formalize \Cref{def:fcomp}.
To formalize fair compliance, we define a \lstinline{Success} predicate that 
characterizes those configurations $\session{R}{S}$ in which the client has succeeded 
($R = \Win$) and the server has not failed ($S \neq \TNil$).

\begin{lstlisting}
data Success : Session $\rightarrow$ Set where
  success : $\forall${R S} $\rightarrow$ Win R $\rightarrow$ Defined S $\rightarrow$ Success (R , S)
\end{lstlisting}

We can weaken \lstinline{Success} to \lstinline{MaySucceed}, 
to characterize those configurations \emph{that can be extended} so as to become successful ones.
For this purpose we make use of the \lstinline{Satisfiable} predicate and of the 
intersection \lstinline{$\cap$} of two sets from Agda's standard library.

\begin{lstlisting}
MaySucceed : Session $\rightarrow$ Set
MaySucceed Se = 
	Relation.Unary.Satisfiable (Reductions Se $\cap$ Success)
\end{lstlisting}

In words, \lstinline{Se} may succeed if there exists \lstinline{Se'}
such that \lstinline{Se $\wred$ Se'} and \lstinline{Se'} is a successful configuration. 
We can now formulate fair compliance as the property of those sessions that may succeed 
no matter how they reduce (see \Cref{def:fcomp}). This is the specification against 
which we prove soundness and completeness of the \GIS for fair compliance (\Cref{fig:compliance}).

\begin{lstlisting}
FCompS : Session $\rightarrow$ Set
FCompS Se = $\forall${Se'} $\rightarrow$ Reductions Se Se' $\rightarrow$ MaySucceed Se'
\end{lstlisting}

\begin{remark}
	As we did in \Cref{sec:agda_ft}, assume that we want to instaciate \lstinline{Specification}
	from \Cref{sec:agda_fairt} by using \lstinline{Session} (see \Cref{ssec:agda_st_formalization_types})
	as set of states and \lstinline{Reduction} (see \Cref{ssec:agda_st_formalization_lts}) as transition system.
	Such instance of \lstinline{Specification} would not be equivalent to \lstinline{FCompS} as fari compliance
	corresponds to a successful form of fair termination.
	In order to make them equivalent we would need to parametrize \lstinline{WeaklyTerminating} on a predicate
	that the reducts have to satisfy. In this case we would say that a state is weakly terminating
	if it reduces to another one that is in normal form and that satisfies the input predicate.
	%
	\eor
\end{remark}

%%%%%%%%%%%%%%%%%
%%% SOUNDNESS %%%
%%%%%%%%%%%%%%%%%

\subsection{Soundness}
\input{agda-prop/fc-corr-soundness}

%%%%%%%%%%%%%%%%%%%%
%%% COMPLETENESS %%%
%%%%%%%%%%%%%%%%%%%%

\subsection{Completeness}
\input{agda-prop/fc-corr-completeness}