\beginbass
%
Here we prove the soundness of the type system (see \Cref{thm:ts_bin_sound}). As already hinted at in
\Cref{ssec:ts_bin_rules}, the proof is loosely based on the method of helpful directions
\Citep{Francez86}, namely on the property that a (well-typed) process \emph{may}
reduce in such a way that its measure strictly decreases. Recall that this
property is not true for every reduction. Here we assume that the reducing
process is in proximity normal form. The same result will be generalized later
on.

\begin{lemma}
	\label{lem:pnf_helpful_direction_bin}
	If\/ $\wtpn\MeasureM\Ctx\Pnf$ where $\Pnf$ is in proximity normal
	form, then there exist $Q$ and $\MeasureN < \MeasureM$ such that $\Pnf
	\wred^+ Q$ and $\wtpn\MeasureN\Ctx{Q}$.
\end{lemma}
\begin{proof}
From the hypothesis that $\Pnf$ is in proximity normal form we know that 
$\Pnf = \PCtxC[\pres{x}{\Pth_1 \parop \Pth_2}]$ for some $\PCtxC$, $x$ and $\Pth_1, \Pth_2$ $x$-threads.
We reason by induction on $\PCtxC$ and by cases on its shape.
	
\proofcase{Case $\PCtxC = \Hole$}
%
From \refrule{mtb-thread} and \refrule{mtb-par} we deduce that there exist $\Ctx_i, S_i, n_i$ for $i=1,2$ such that
\begin{itemize}
\item $\Ctx = \Ctx_1,\Ctx_2$
\item $\Measure = (n_1 + n_2 , \rankb{S_1}{S_2})$
\item $\wtp[n_1]{\Ctx_1, x : S_1}{\Pth_1}$
\item $\wtp[n_2]{\Ctx_2, x : S_2}{\Pth_2}$
\item $S_1 \compatible S_2$
\end{itemize}
From the hypothesis that $S_1 \compatible S_2$ we deduce 
$S_1 \wlred{\co\actions} \End[\co\Pol], S_2 \wlred\actions \End[\Pol]$ for some $\actions$. 
We now reason on the rank of the session and on the shape of $S_i$. 
For the sake of simplicity, we implicitly apply \refrule{sb-par-comm} at process level.\\\\
%
If $\rankb{S_1}{S_2} = 0$, then $S_1 = \End[\co\Pol]$ and $S_2 = \End[\Pol]$ for some $\Pol$.
%
\begin{itemize}
\item \proofcase{Case $S_1 = \End[\In]$ and $S_2 = \End[\Out]$}
%
Then 
	\begin{itemize}
	\item $\Ctx_2 = \EmptyCtx$ and $\Pth_2 = \pclose{x}$
	\item $\Pth_1 = \pwait{x}{Q}$
	\item $\wtp[n_1]{\Ctx_1}{Q}$
	\end{itemize}
From \Cref{lem:measure_rank_bin} we deduce that $\wtpn{\MeasureN}{\Ctx_1}{Q}$ for some $\MeasureN \le (n_1 , 0)$. 
We conclude observing that $\Pnf \red Q$ by \refrule{rb-signal} and that 
$\MeasureN \le (n_1 , 0) < (n_1 + n_2 , \rankb{S_1}{S_2}) = \Measure$.
\end{itemize}
%
If $\rankb{S_1}{S_2} > 1$, then $\Sys{S_1}{S_2} \lred{\tau} \dots \lred\tau \Sys{\End[\co\Pol]}{\End[\Pol]}$ 
first using \refrule{lb-tau-l}/\refrule{lb-tau-r} and \refrule{lb-sync}. 
Observe that \refrule{lb-pick} is never used since we are considering the minimum reduction sequence; 
a synchronization through \refrule{lb-pick} and \refrule{lb-sync} would lead to a longer reduction. T
hen $S_1 \xlred{\Out{\Tag_k}}$ and $S_2 \xlred{\In{\Tag_k}}$ for some 
$\Tag_k$ or $S_1 \xlred{\Out U}$ and $S_2 \xlred{\In U}$ for some $U$.
%
\begin{itemize}
\item \proofcase{Case $S_1 = \Tags\Out \Tag_i.S'_i$ and $S_2 = \JTags\In \Tag_j.T_j$ with $k \in I$}
%
From the hypothesis that $S_1 \compatible \S_2$ we deduce $I \subseteq J$. 
From \refrule{tb-tag} we deduce that 
	\begin{itemize}
	\item $\Pth_1 = \x\oact\set{{\Tag_i}.{P'_i}}_{i \in I}$
	\item $\Pth_2 = \x\iact\set{{\Tag_j}.{Q_j}}_{j \in J}$
	\item $\wtp[n_1]{\Ctx_1, x : S'_i}{P'_i}$ for all $i \in I$
	\item $\wtp[n_2]{\Ctx_2, x : T_j}{Q_j}$ for all $j \in J$
	\end{itemize}
Let $Q \eqdef \pres{x}{P'_k \parop Q_k}$ and observe that $\Pnf \wred^+ Q$ by \refrule{rb-pick} and \refrule{rb-tag}. 
From \Cref{lem:measure_rank_multi} we deduce that there exist $\Measure_1 \le (n_1 , 0), \Measure_2 \le (n_2 , 0)$ such that
	\begin{itemize}
	\item $\wtpn{\Measure_1}{x : S'_k}{P'_k}$
	\item $\wtpn{\Measure_2}{x : T_k}{Q_k}$
	\end{itemize}
Let 
$\MeasureN \eqdef \Measure_1 
	+ \Measure_2 
	+ (0 , \rankb{S'_k}{T_k})$. 
We conclude with one application of \refrule{mtb-par} observing that
\[
\begin{array}{rcll}
	\MeasureN & = & \Measure_1 + \Measure_2 + (0 , \rankb{S'_k}{T_k}) & \text{by def. of $\MeasureN$}
	\\
	& \le & (n_1 + n_2 , \rankb{S'_k}{T_k}) & \text{by \Cref{lem:measure_rank_bin}}
	\\
	& < & (n_1 + n_2 , \rankb{S_1}{S_2}) & \text{before $\red$}
	\\
	& = & \Measure
\end{array}
\]
\end{itemize}
%
\begin{itemize}
\item \proofcase{Case $S_1 = \Out{S}.T_1$ and $S_2 = \In{S}.T_2$}
\end{itemize}
%
From the hypothesis that $S_1 \compatible S_2$ and \Cref{def:compatibility} we deduce 
$T_1 \compatible T_2$ and from 
\refrule{tb-channel-out} and \refrule{tb-channel-in} we deduce that
	\begin{itemize}
	\item $\Pth_1 = \POutput{\x}{\y}.{P'_1}$
	\item $\Pth_2 = \PInput{\x}{\y}.{P'_2}$
	\item $\wtp[n_1]{\Ctx_1, x : T_1}{P'_1}$
	\item $\wtp[n_2]{\Ctx_2, x : T_2, y : S}{P'_2}$
	\end{itemize}
Let $Q \eqdef \pres{x}{P'_1 \parop P'_2}$ and observe that $\Pnf \red Q$ by \refrule{rb-channel}. 
From \Cref{lem:measure_rank_bin} we deduce that there exist $\Measure_1 \le (n_1 , 0), \Measure_2 \le (n_2 , 0)$ such that
	\begin{itemize}
	\item $\wtpn{\Measure_1}{\Ctx_1, x : T_1}{P'_1}$
	\item $\wtpn{\Measure_2}{\Ctx_2, x, y : S}{P'_2}$
	\end{itemize}
Let $\MeasureN \eqdef \Measure_1 
	+ \Measure_2 
	+ (0 , \rankb{T_1}{T_2})$. 
We conclude with one application of \refrule{mtb-par} observing that
\[
\begin{array}{rcll}
	\MeasureN & = & \Measure_1 + \Measure_2 + (0 , \rankb{T_1}{T_2}) & \text{by definition of $\MeasureN$}
	\\
	& \le & (n_1 + n_2 , \rankb{T_1}{T_2}) & \text{by \Cref{lem:measure_rank_multi}}
	\\
	& < & (n_1 + n_2 , \rankb{S_1}{S_2}) & \text{before reductions}
	\\
	& = & \Measure
\end{array}
\]

\proofcase{Case $\PCtxC = \pres{y}{\PCtxD \parop \Qpar}$}
%
Let $\Rnf \eqdef \PCtxD[\pres{x}{\Pth_1 \parop \Pth_2}]$ and observe that $\Rnf$ is in proximity normal form. 
From \refrule{mtb-par} we deduce that there exist $\Ctx_i, S_i, \Measure_i$ for $i=1,2$ such that
\begin{itemize}
\item $\Ctx = \Ctx_1,\Ctx_2$
\item $\wtpn{\Measure_1}{\Ctx_1, y : S_1}{\Rnf}$
\item $\wtpn{\Measure_2}{\Ctx_2, y : S_2}{\Qpar}$
\item $\Measure = \Measure_1 + \Measure_2 + (0 , \rankb{S_1}{S_2})$
\end{itemize}
Using the induction hypothesis on $\wtpn{\Measure_1}{\Ctx_1, y : S_1}{\Rnf}$ we deduce that there 
exists $Q'$ and $\MeasureN' < \Measure_1$ such that
\begin{itemize}
\item $\Rnf \wred^+ Q'$
\item $\wtpn{\MeasureN'}{\Ctx_1, y : S_1}{Q'}$
\end{itemize}
We conclude taking $Q \eqdef \pres{t}{Q' \parop \Qpar}$ and
\[
	\MeasureN \eqdef \MeasureN' + \Measure_2 + (0 , \rankb{S_1}{S_2})
\] 
and observing that $\MeasureN < \Measure$ and $\Pnf \wred^+ Q$ by \refrule{rb-par}.

\proofcase{Case $\PCtxC = \pres{x}{\Qpar \parop \PCtxD}$}
%
Symmetric to the previous case.

\proofcase{Case $\PCtxC = \pcast{y}{\PCtxD}$}
%
Observe that $x \ne y$. Let $\Rnf \eqdef \PCtxD[\pres{x}{\Pth_1 \parop \Pth_2}]$ 
and note that $\Rnf$ is in proximity normal form. 
From \refrule{mtb-cast} we deduce that there exists $\CtxD, \Measure', S, T, m_y$ such that
\begin{itemize}
\item $\Ctx = \CtxD, y : S$
\item $S \subt[m_y] T$
\item $\Measure = \Measure' + (m_y , 0)$
\item $\wtpn{\Measure'}{\CtxD, y : T}{\Rnf}$
\end{itemize}
Using the induction hypothesis on $\wtpn{\Measure'}{\CtxD, y : T}{\Rnf}$ we deduce that 
there exist $Q'$ and $\MeasureN' < \Measure'$ such that $\Rnf \wred^+ Q'$ and $\wtpn{\MeasureN'}{\CtxD, y : T}{Q'}$. 
We conclude taking $Q \eqdef \pcast{y}{Q'}$ and $\MeasureN \eqdef \MeasureN' + (m_y , 0)$ 
and observing that $\MeasureN < \Measure$ and $\Pnf \wred^+ Q$ by \refrule{rb-cast}.
\end{proof}

Now we prove that any well-typed, closed process can be either rewritten to $\Done$ 
using structural pre-congruence or reduced so as to obtain a strictly smaller measure.

\begin{lemma}
  \label{lem:helpful_direction_bin}
  If\/ $\wtpn\MeasureM\EmptyCtx{P}$, then either $P \pcong \Done$ or $P
  \wred^+ Q$ and $\wtpn\MeasureN\EmptyCtx{Q}$ for some $Q$ and $\MeasureN
  < \MeasureM$.
\end{lemma}
\begin{proof}
    Using \Cref{lem:cnf_exists_bin} we deduce that there exist $P'$ in choice normal form such that 
    $P \wred P'$ and $\wtpn{\MeasureM'}\EmptyCtx{P'}$ and $\MeasureM' \leq \MeasureM$.
    %
    By \Cref{lem:measure_rank_bin} we deduce $\wtp\EmptyCtx{P'}$.
    %
    Using \Cref{lem:tnf_exists_bin} we deduce that there exist $\Pnf$ such that $P' \pcong
    \Pnf$.
    %
    If $\Pnf = \Done$ there is nothing left to prove.
    %
    If $\Pnf \neq \Done$, by \Cref{lem:dl_freedom_bin} we deduce $\Pnf \pcong \Qnf$ for
    some $\Qnf$ in proximity normal form.
    %
    From \Cref{lem:m_pcong_bin} we deduce $\wtpn{\MeasureM''}\EmptyCtx\Qnf$ for some $\MeasureM'' \leq \MeasureM'$.
    %
    Using \Cref{lem:pnf_helpful_direction_bin} we conclude that $\Qnf \wred^+ Q$ and
    $\wtpn\MeasureN\EmptyCtx Q$ for some $Q$ and $\MeasureN < \MeasureM'' \leq \MeasureM' \leq \MeasureM$.
\end{proof}

Using \Cref{lem:helpful_direction_bin} we can prove that a well-typed, closed process weakly terminates. 
Namely, that there exists a finite reduction sequence to $\Done$.

\begin{lemma}[Weak Termination]
	\label{lem:weak_termination_bin}
	If\/ $\wtp[n]\EmptyCtx{P}$, then either $P \pcong \Done$ or $P \wred^+
	\Done$.
\end{lemma}
\begin{proof}
	From \Cref{lem:measure_rank_bin} we deduce that there exists $\MeasureM \le (n,
	0)$ such that $\wtpn\MeasureM\EmptyCtx P$.
    %
	We proceed doing an induction on the lexicographically ordered pair $\MeasureM$.
	%
    From \Cref{lem:helpful_direction_bin} we deduce either $P \pcong \Done$ or $P
    \wred^+ Q$ and $\wtpn\MeasureN\EmptyCtx{Q}$ for some $\MeasureN <
    \MeasureM$.
    %
    In the first case there is nothing left to prove.
    %
    In the second case we use the induction hypothesis to deduce that either $Q
    \pcong \Done$ or $Q \wred^+ \Done$.
    %
    We conclude using either \refrule{rb-struct} or the transitivity of
    $\wred^+$, respectively.
\end{proof}

The soundness of the type system is now a simple corollary.

\begin{proof}[Proof of \Cref{thm:ts_bin_sound}]
    Consequence of \Cref{lem:subj_red_bin} and \Cref{lem:weak_termination_bin}.
\end{proof}