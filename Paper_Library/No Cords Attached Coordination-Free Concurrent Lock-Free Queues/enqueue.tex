\begin{algorithm}
\caption{Lock-Free Enqueue}
\begin{algorithmic}[1]
\Function{enqueue}{queue, data}
   \State \textit{// Phase 1: Node allocation and cycle assignment}
   \State $new\_node \gets$ allocate\_node$()$
   \State $new\_node.data \gets data$
   \State $new\_node.next \gets$ NULL
   \State $new\_node.state \gets$ AVAILABLE
   \State $cycle \gets$ INCREMENT$(queue.cycle)$
   \State $new\_node.cycle \gets cycle$
   
   \State \textit{// Phase 2: Lock-free Insertion}
   \State $retry\_count \gets 0$
   \Repeat
       \State $tail \gets$ LOAD$(queue.tail)$
       \State $next \gets$ LOAD$(tail.next)$
       \State \textit{// Pre-check to avoid expensive CAS (OPTIONAL)}
       \If{$next \neq$ NULL}
           \State \textit{// Tail has advanced, retry with fresh state}
           \State $retry\_count \gets retry\_count + 1$
           \If{$retry\_count > 3$}
               \State CPU\_PAUSE$()$
           \EndIf
           \State \textbf{continue}
       \EndIf
       \State \textit{// Attempt to link new node}
       \If{CAS$(tail.next,$ NULL$, new\_node)$}
           \State \textit{// Optional tail advancement}
           \State CAS$(queue.tail, tail, new\_node)$
           \State \textbf{break}
       \EndIf
   \Until{false}
   
   \State \textit{// Phase 3: Conditional Reclamation}
   \If{$(cycle \bmod N) = 0$}
       \State trigger\_reclamation$(queue)$
   \EndIf
   \State \Return SUCCESS
\EndFunction
\end{algorithmic}
\end{algorithm}
