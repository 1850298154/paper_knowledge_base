\section{Generalized subtour elimination constraints and edge-based formulations for vehicle routing problems}
\label{section:setup}

We begin our discussion with the definition of a generic class of VRPs. We are given a complete undirected graph~$G_0 = (V_0, E_0)$ with edge costs~$c \in \Q^{E_0}_+$. The set of vertices~$V_0 = \{0\} \dot\cup V$ contains a special vertex denoted~$0 \in V_0$ representing the \emph{depot}, while the remaining vertices in~$V$ represent the \emph{customers}. We have~$k \in \Z_{++}$ available vehicles, all located initially at the depot. For convenience, we also set~$G = G_0 - \{0\} = (V, E)$, that is,~$G$ is the graph obtained from~$G_0$ by removing the depot.

Let \hypertarget{def:routes}{$\mc{R}$} be a family of feasible paths (or routes) in~$G$. We define problem \hypertarget{problem:vrp}{$\tsc{vrp-prob}(\mc{R})$} as follows. Let~$\mc{S} = \{C_1, \ldots, C_k\}$ be a set of~$k$ (simple) cycles, where each~$C_i \subseteq G_0$ contains the depot. Let~$P_i = C_i - \{0\} \subseteq G$ be the path obtained from~$C_i$ by deleting the depot. We say that~$\mc{S}$ is \emph{feasible} for~$\vrpprob{\mc{R}}$ if each~$P_i$ belongs to~$\routes$ and~$\{V(P_i)\}_{i \in [k]}$ forms a partition of~$V$. The objective of~$\vrpprob{\mc{R}}$ is to find a feasible solution~$\mc{S} = \{C_1, \ldots, C_k\}$ that minimizes the edge costs~$\sum_{i \in [k]} c(E_0(C_i))$.

All the VRPs mentioned in the introduction~\cite{laporte1983branch, gounaris2013robust, Dinh2018, ghosal2020, ghosal2024, dell2014bike} can be expressed as problems in the form of~$\vrpprob{\mc{R}}$.%
\footnote{
Some of these VRPs may allow solutions that use at most~$k$ cycles, and our reasoning extends naturally to this case. On the other hand, we do not address here VRPs that allow solutions visiting customers more than once, such as the VRPs with \emph{splittable demands}~\cite{archetti2008split}.}
For instance, the classical capacitated vehicle routing problem (CVRP) corresponds to problem~$\vrpprob{\mc{R}_{\tsc{cvrp}}}$, where~$\mc{R}_{\tsc{cvrp}} = \{\text{path~$P \subseteq G$} : d(V(P)) \leq C\}$,~$d \in \Q^V_+$ is a vector of customer demands, and~$Q \in \Q_+$ is the vehicle capacity. 

For any subset~$\emptyset \subsetneq S \subseteq V$, define \hypertarget{def:fcvrp}{$f_{\textsc{cvrp}}(S) \coloneqq \max\{1, \lceil d(S)/Q \rceil\}$}. A well-known CVRP formulation due to Laporte and Nobert~\cite{laporte1983branch} is as follows:
\begin{subequations}
\label{form:cvrp}
\begin{align}
    \tsc{vrp-form}(\fcvrp) \quad \quad \quad \min~~ & c^\T x \\
    \text{s.t.~~} & x(\delta_{G_0}(0)) = 2k, \label{eq:cvrp_depot} \\
    & x(\delta_{G_0}(v)) = 2, & \forall v \in V \label{eq:cvrp_customers} \\
    & x(S) \leq |S| - \fcvrp{S}, & \forall \emptyset \subsetneq S \subseteq V, \label{ineq:cvrp_gsec} \\
    & x_e \leq 1 + \mb{I}(0 \in e), & \forall e \in E_0, \\
    & x \in \Z^{E_0}_+,
\end{align}
\end{subequations}
where~$\mb{I}(\,\cdot\,)$ denotes the indicator function. Inequalities~\eqref{ineq:cvrp_gsec} are named GSECs, since they reduce to the standard \emph{subtour elimination constraints} (SECs) whenever~$\fcvrp{S} = 1$, for all~$\emptyset \subsetneq S \subseteq V$ (see~\cite{TothV02, laporte1986generalized}).

To associate Formulation~\eqref{form:cvrp} with different VRPs, we introduce the following definition.
\begin{definition}
    \label{def:rhs_function}
    A function~$f : 2^{V} \to \Z_+$ is a \emph{RHS function} if~$f(S) \in \{1, \ldots, |S|\}$, for every~$\emptyset \subsetneq S \subseteq V$. For convenience, the function~$f$ also satisfies~$f(\emptyset) = 0$.
\end{definition}
IP formulations for many VRPSD variants~\cite{gounaris2013robust, Dinh2018, ghosal2020, ghosal2024} can be obtained from Formulation~\eqref{form:cvrp} by just replacing the RHS function~$\fcvrp$.%
\footnote{Certain formulations instead use inequalities~$x(\delta_{G_0}(S)) \geq 2 \f{S}$. These inequalities can be shown to be equivalent to the GSECs by summing the degree constraints~\eqref{eq:cvrp_customers} over all~$v \in S$. When the formulation is instead defined on a complete directed graph~$D = (\{0\}\cup V, A)$ (with~$x \in \R^A$), the analogous inequalities~$x(\delta_D^+(S)) \geq \f{S}$ are also equivalent to the GSECs~$x(S) \le |S| - \f{S}$.}
The framework of Ghosal et al.~\cite{ghosal2024} partially explains this phenomenon, as they establish that~$\vrpprob{\routes}$ can be solved with~$\vrpform{f}$ (for some RHS function~$\f$) whenever the family of feasible paths~$\routes$ contains every path with at most one vertex and is both \emph{downward closed} and \emph{permutation invariant}, which we formally define next. 

For convenience in the following sections, we present these properties with respect to a general family of subgraphs~$\mc{H}$, rather than the family of feasible paths~$\routes$. Since general graphs cannot be written as tuples (as in the case of paths), we replace the term permutation invariance with \emph{vertex-consistency}.

\begin{definition}
    \label{def:downward_closed}
    A family of subgraphs~$\mc{H}$ of~$G$ is \emph{downward closed} if, for every~$F \in \mc{H}$ and~$F' \subseteq F$, we have that~$F' \in \mc{H}$.
\end{definition}

\begin{definition}
    \label{def:vertex_consistency}
    A family of subgraphs~$\mc{H}$ of~$G$ is \emph{vertex-consistent} if, for every~$F, F' \subseteq G$ with~$V(F) = V(F')$, we have that~$F \in \mc{H}$ if and only if~$F' \in \mc{H}$.
\end{definition}

\noindent
In fact, when applied to the family of feasible paths~$\routes$, the downward closedness property of Ghosal et al.~\cite{ghosal2024} is stronger than Definition~\ref{def:downward_closed}, as it states that if~$P = (v_1, \ldots, v_\ell) \in \routes$, then~$P' = (v_{i_1}, \ldots, v_{i_t}) \in \routes$, for every~$1 \leq i_1 < \ldots < i_t \leq \ell$. One can verify, however, that if~$\routes$ satisfies Definition~\ref{def:vertex_consistency}, then the two properties are equivalent.

As pointed out in Section~\ref{section:intro}, although the framework of Ghosal et al.~\cite{ghosal2024} unifies several VRPSD variants, it does not capture the GSEC-based formulation of Dellâ€™Amico et al.~\cite{dell2014bike} for the BRP (or the 1-commodity pickup-and-delivery TSP formulation of~\cite{hernandez2003one}). In this problem, denoted~$\vrpprob{\mc{R}_{\tsc{brp}}}$, the vehicle load represents bikes, while the demands correspond to the number of bikes that must be picked up or delivered at each station. Vehicles are located at a central depot and start their routes with an initial load between~$0$ and~$Q \in \Q_+$. Customer demands~$d_v$ can be positive or negative (with~$|d_v| \leq Q$), and the accumulated load along a route must always remain within the interval~$[0, Q]$. Dell'Amico et al.~\cite{dell2014bike} show that the BRP can be formulated as~$\vrpform{f_{\tsc{brp}}}$, where, for every~$\emptyset \subsetneq S \subseteq V$, \hypertarget{def:fbrp}{$f_{\tsc{brp}}(S) \coloneqq \max\{1, \lceil |d(S)| / Q \rceil\}$}.

Formally, a path~$P = (v_1, \ldots, v_\ell)$ belongs to \hypertarget{def:routes_brp}{$\mc{R}_{\tsc{brp}}$} if and only if there exists an initial load~$q \in [0, Q] \cap \Q$ such that~$0 \leq q + \sum_{j \in [i]} d_{v_i} \leq Q$, for all~$i \in [\ell]$. Or equivalently (see Proposition~\ref{prop:brp}), if there exists~$q'$ such that~$0 \leq q' + \sum_{j = i}^\ell d_{v_i} \leq Q$, for all~$i \in [\ell]$. The following simple example shows that~$\routesbrp$ may not be vertex-consistent.

\begin{example}
\label{example:brp}
Suppose that~$Q = 1$,~$k = 1$ and we only have three customers~$v_1$,~$v_2$ and~$v_3$, with demands~$d_{v_1} = 1$,~$d_{v_2} = 1$ and~$d_{v_3} = -1$. Consider a route that starts at the depot and visits customers~$v_1, v_2, v_3$, in this order. This route corresponds to path~$P = (v_1, v_2, v_3)$, which does not belong to~$\routesbrp$, since~$d_{v_1} + d_{v_2} = 2 > 1 = Q$. On the other hand,~$P' = (v_1, v_3, v_2) \in \routesbrp$, as the vehicle can leave the depot with zero initial load and the accumulated load stays within~$[0, Q]$ at all times.~\qed
\end{example}

Example~\ref{example:brp} raises the question of which problems of the form~$\vrpprob{\mc{R}}$ can be modeled using GSECs but are not captured by the sufficient conditions of Ghosal et al.~\cite{ghosal2024}. To investigate this further, in Section~\ref{section:representation}, we drop the degree constraints~\eqref{eq:cvrp_depot} and~\eqref{eq:cvrp_customers} from Formulation~\eqref{form:cvrp}, and we characterize the forests that can be represented solely with the GSECs and the edge upper-bound constraints. Once these tools are developed, we reintroduce the degree constraints in Section~\ref{section:extension}.
