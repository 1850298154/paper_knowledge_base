\makeatletter

\npdecimalsign{\text{.}}

\newcommand\tabResultsRows{}

\def\prodTime{1}
\def\prodMem{1}
\newcounter{benchmarkCount}

\newcommand\addRow[8]{
  \def\benchname{#1}
  \def\basetime{#2} % s
  \def\veriftime{#3} % s
  \def\basemem{#4} % kB
  \def\verifmem{#5} % kB
  \def\ntasks{#6}
  \def\nsets{#7}
  \def\ngets{#8}
  \stepcounter{benchmarkCount}

  \def\timeOverhead{\fpeval{\veriftime / \basetime}}
  \def\setRate{\fpeval{\nsets / \basetime / 1000}}
  \global\edef\prodTime{\fpeval{\prodTime * \timeOverhead}}

  \def\memOverhead{\fpeval{\verifmem / \basemem}}
  \def\getRate{\fpeval{\ngets / \basetime / 1000}}
  \global\edef\prodMem{\fpeval{\prodMem * \memOverhead}}

  \edef\tmp{\noexpand\createRow{\benchname}{\basetime}{\timeOverhead}{\fpeval{\basemem / 1024}}{\memOverhead}{\ntasks}{\setRate}{\getRate}}
  \tmp
}
\newcommand\createRow[8]{
  \g@addto@macro\tabResultsRows{
    #1
    & \nprounddigits{2}\numprint{#2} & \nprounddigits{2}\numprint{#3}$\times$
    & \nprounddigits{2}\numprint{#4} & \nprounddigits{2}\numprint{#5}$\times$
    & #6 & \nprounddigits{2}\numprint{#7} & \nprounddigits{2}\numprint{#8} \\
  }
}

\newcommand\geomean[2]{%
  \nprounddigits{2}%
  \edef\tmp{\noexpand\numprint{\fpeval{#1 ^ (1 / #2)}}}\expandafter
  \tmp$\times$\xspace
}
\newcommand\geomeanFancy[2]{%
  \nprounddigits{0}%
  \edef\tmp{\noexpand\numprint{\fpeval{
      ((#1 ^ (1 / #2)) - 1) * 100}}}\expandafter
  \tmp\% (\geomean{#1}{#2})
}

\input{data.tex}
\def\geomeanTime{\geomean{\prodTime}{\value{benchmarkCount}}}
\def\geomeanMem{\geomean{\prodMem}{\value{benchmarkCount}}}
\def\geomeanTimeFancy{\geomeanFancy{\prodTime}{\value{benchmarkCount}}}
\def\geomeanMemFancy{\geomeanFancy{\prodMem}{\value{benchmarkCount}}}
\g@addto@macro\tabResultsRows{
  \bottomrule\addlinespace[3pt]
  \multicolumn{2}{r}{Geometric Mean Overhead}
  &\multicolumn{1}{c}{\geomeanTime}
  &&\multicolumn{1}{c}{\geomeanMem}
}

\def\tabResults{
  \begin{table*}
    \caption{Mean execution time and memory overheads for verification.}
    \label{tab:results}
    \begin{tabular}{r r c r c | r r r}
      & \multicolumn{2}{c}{Time}
      & \multicolumn{2}{c}{Memory} \\
      \multicolumn{1}{c}{Benchmark}
      & \multicolumn{1}{c}{Baseline (s)}
      & \multicolumn{1}{c}{Overhead}
      & \multicolumn{1}{r}{Baseline (MB)}
      & \multicolumn{1}{c}{Overhead}
      & \multicolumn{1}{c}{Tasks}
      & \multicolumn{1}{c}{Gets/ms}
      & \multicolumn{1}{c}{Sets/ms} \\
      %
      \toprule
      \tabResultsRows
    \end{tabular}
  \end{table*}
}


\makeatother
