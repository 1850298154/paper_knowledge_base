{
  \begin{algorithm}[tb!]
    \caption{Potential Cyclic Deadlock Detection}
    \label{algo:detecting-deadlock}
    \textbf{Input}:~a set of paths $\{ \path{1}, \ldots, \path{n} \}$\\
    \textbf{Output}:~one potential cyclic deadlock or \textbf{NONE}\\
    \small
    \begin{algorithmic}[1]
      \newcommand{\cfrom}{\m{\theta_{\mathit{f}}}}
      \newcommand{\cto}{\m{\theta_{\mathit{t}}}}
      \newcommand{\cnew}{\m{\theta}}
      %
      \State $\tablefrom, \tableto \leftarrow \emptyset$
      \Comment table for fragments, key: vertex
      %
      \medskip
      \Procedure{register}{$\theta$}
      \State $i, t_i, j, t_j \leftarrow \theta.\{\text{agents}, \text{indexes}\}\{[1], [-1]\}$
      \State $\tablefrom[\loc{i}{t_i}]$.append($\theta$)
      \State $\tableto[\loc{j}{t_j+1}]$.append($\theta$)
      \EndProcedure
      \medskip
      \Function{isPotentialDeadlock}{$\theta$}
      \State $i, t_i, j, t_j \leftarrow \theta.\{\text{agents}, \text{indexes}\}\{[1], [-1]\}$
      \State \Return $\loc{i}{t_i} = \loc{j}{t_j+1}$
      \EndFunction
      \medskip
      %
      \For{$i = 1\ldots n$}
      \label{algo:deadlock:for-agents}

      \For{$j= 1\ldots |\path{i}|-1$}
      \label{algo:deadlock:for-t}
      \State $u \leftarrow \loc{i}{j}, v \leftarrow \loc{i}{j+1}$
      \medskip
      %
      \State $\cnew \leftarrow \fragment{(i)}{(j)}$
      \label{algo:deadlock:add-own}
      \Comment{single fragment}
      \State \Call{register}{$\cnew$}
      \label{algo:deadlock:add-own:register}
      \medskip
      %
      \For{$\cto \in \tableto[u]$}
      \label{algo:deadlock:tableto}
      \Comment{check fragments on \tableto}
      \IFSINGLE{$i \in \cto.\text{agents}$}{\CONTINUE}
      \State $\cnew \leftarrow \fragment{\cto.\text{agents} + i}{\cto.\text{indexes} + j}$
      \IFSINGLE{\Call{isPotentialDeadlock}{$\theta$}}{\textbf{return} \cnew}
      \label{algo:deadlock:tableto:detecting}
      \State \Call{register}{$\cnew$}
      \EndFor
      \label{algo:deadlock:tableto:end}
      \medskip
      %
      \For{$\cfrom \in \tablefrom[v]$}
      \label{algo:deadlock:tablefrom}
      \Comment{check fragments on \tablefrom}
      \IFSINGLE{$i \in \cfrom.\text{agents}$}{\CONTINUE}
      \State $\cnew \leftarrow \begin{aligned}[t] \{
        \text{agents:}~i + \cfrom.\text{agents},
        \text{indexes:}~j + \cfrom.\text{indexes}
      \}\end{aligned}$
      \IFSINGLE{\Call{isPotentialDeadlock}{$\theta$}}{\textbf{return} \cnew}
      \label{algo:deadlock:tablefrom:detecting}
      \State \Call{register}{$\cnew$}
      \EndFor
      \label{algo:deadlock:tablefrom:end}
      \medskip
      %
      \For{$\cto \in \tableto[u]$, $\cfrom \in \tablefrom[v]$}
      \label{algo:deadlock:connect-two}
      \Comment{connect two fragments}
      \IFSINGLE{$i \in \cto.\text{agents} \cup \cfrom.\text{agents}$}{\CONTINUE}
      \IFSINGLE{$\cto.\text{agents} \cap \cfrom.\text{agents} \neq \emptyset$}{\CONTINUE}
      \State $\cnew \leftarrow \begin{aligned}[t] \{
        &\text{agents:}~\cto.\text{agents} + i + \cfrom.\text{agents}\\
        &\text{indexes:}~\cto.\text{indexes} + j + \cfrom.\text{indexes}
        \}\end{aligned}$
      \IFSINGLE{\Call{isPotentialDeadlock}{$\theta$}}{\textbf{return} \cnew}
      \label{algo:deadlock:connect-two:detecting}
      \State \Call{register}{$\cnew$}
      \EndFor
      \label{algo:deadlock:connect-two:end}
      %
      \EndFor
      \label{algo:deadlock:for-t-end}
      \EndFor
      \label{algo:deadlock:for-agents-end}
      %
      \State \Return \textbf{NONE}
    \end{algorithmic}
  \end{algorithm}
}
