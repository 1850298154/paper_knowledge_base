\floatname{algorithm}{Algorithm}
\begin{algorithm}[H]
\caption{Strategy Refinement from Auction Memory}
\label{alg:refinement}
\begin{algorithmic}
\hrule
\vspace{0.5em}
\Require Task $t$, agents $\mathcal{A}$, memory $\mathcal{M}$, learned weights $w$, retrieval size $k$
\Ensure Final agent assignment $i^*(t)$
\\
\For{each agent $a_i \in \mathcal{A}$}
    \State Generate initial strategy $s_{t,i}$
    \State Compute cost $C_{t,i} \gets w_c \cdot \pi(a_i) \cdot |s_{t,i}|$
    \State Compute value $V_{t,i} \gets w_h \cdot H(s_{t,i}) + \sum_{a_j \in \mathcal{A}} w_j \cdot \gamma_j(s_{t,i})$
\EndFor
\\
\State $\hat{i}(t) \gets \arg\min_{i} (C_{t,i} - V_{t,i})$
\State $i^*(t) \gets \hat{i}(t)$
\\
\For{each agent $a_i \in \mathcal{A}$ where $\pi(a_i) < \pi(a_{\hat{i}(t)})$}
    \State $\tilde{k} \gets \min(k, |\mathcal{T}_{\mathcal{M}}|)$
    \State Retrieve $\mathcal{T}' \gets \operatorname{top\text{-}\tilde{k}}_{t' \in \mathcal{T}_{\mathcal{M}}} \mathrm{sim}(t, t')$
    \State $\mathcal{M}_{t,i} \gets \{(s^{\text{lose}}_{t'}, s^{\text{win}}_{t'})_i \mid t' \in \mathcal{T}'\}$
    \State Format $\mathcal{M}_{t,i}$ as contrastive examples
    \State Generate refined strategy $s^r_{t,i}$ conditioned on $s_{t,i}$ and $\mathcal{M}_{t,i}$
    \State Compute $C^r_{t,i} \gets w_c \cdot \pi(a_i) \cdot |s^r_{t,i}|$
    \State Compute $V^r_{t,i} \gets w_h \cdot H(s^r_{t,i}) + \sum_{a_j \in \mathcal{A}} w_j \cdot \gamma_j(s^r_{t,i})$
    \If{$C^r_{t,i} - V^r_{t,i} < C_{t,i^*(t)} - V_{t,i^*(t)}$}
        \State $i^*(t) \gets i$
    \EndIf
\EndFor
\\
\State \Return $i^*(t)$
\end{algorithmic}
\vspace{0.5em}
\hrule
\end{algorithm}